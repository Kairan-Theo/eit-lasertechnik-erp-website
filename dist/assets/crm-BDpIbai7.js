import{R as Nt,j as e,a as p}from"./index-BS0Ij8SW.js";import{N as St}from"./navigation-DW0cn6Qn.js";import{L as Ct}from"./language-context-BfcVNXdW.js";class V{constructor(m=0,x="Network Error"){this.status=m,this.text=x}}const Dt=()=>{if(!(typeof localStorage>"u"))return{get:c=>Promise.resolve(localStorage.getItem(c)),set:(c,m)=>Promise.resolve(localStorage.setItem(c,m)),remove:c=>Promise.resolve(localStorage.removeItem(c))}},f={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Dt()},he=c=>c?typeof c=="string"?{publicKey:c}:c.toString()==="[object Object]"?c:{}:{},It=(c,m="https://api.emailjs.com")=>{if(!c)return;const x=he(c);f.publicKey=x.publicKey,f.blockHeadless=x.blockHeadless,f.storageProvider=x.storageProvider,f.blockList=x.blockList,f.limitRate=x.limitRate,f.origin=x.origin||m},Ke=async(c,m,x={})=>{const v=await fetch(f.origin+c,{method:"POST",headers:x,body:m}),b=await v.text(),k=new V(v.status,b);if(v.ok)return k;throw k},_e=(c,m,x)=>{if(!c||typeof c!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!m||typeof m!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!x||typeof x!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Tt=c=>{if(c&&c.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Fe=c=>c.webdriver||!c.languages||c.languages.length===0,$e=()=>new V(451,"Unavailable For Headless Browser"),Pt=(c,m)=>{if(!Array.isArray(c))throw"The BlockList list has to be an array";if(typeof m!="string")throw"The BlockList watchVariable has to be a string"},Rt=c=>{var m;return!((m=c.list)!=null&&m.length)||!c.watchVariable},At=(c,m)=>c instanceof FormData?c.get(m):c[m],He=(c,m)=>{if(Rt(c))return!1;Pt(c.list,c.watchVariable);const x=At(m,c.watchVariable);return typeof x!="string"?!1:c.list.includes(x)},We=()=>new V(403,"Forbidden"),Bt=(c,m)=>{if(typeof c!="number"||c<0)throw"The LimitRate throttle has to be a positive number";if(m&&typeof m!="string")throw"The LimitRate ID has to be a non-empty string"},Et=async(c,m,x)=>{const v=Number(await x.get(c)||0);return m-Date.now()+v},Ve=async(c,m,x)=>{if(!m.throttle||!x)return!1;Bt(m.throttle,m.id);const v=m.id||c;return await Et(v,m.throttle,x)>0?!0:(await x.set(v,Date.now().toString()),!1)},ze=()=>new V(429,"Too Many Requests"),Mt=async(c,m,x,v)=>{const b=he(v),k=b.publicKey||f.publicKey,H=b.blockHeadless||f.blockHeadless,C=b.storageProvider||f.storageProvider,L={...f.blockList,...b.blockList},I={...f.limitRate,...b.limitRate};return H&&Fe(navigator)?Promise.reject($e()):(_e(k,c,m),Tt(x),x&&He(L,x)?Promise.reject(We()):await Ve(location.pathname,I,C)?Promise.reject(ze()):Ke("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:k,service_id:c,template_id:m,template_params:x}),{"Content-type":"application/json"}))},Ot=c=>{if(!c||c.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Lt=c=>typeof c=="string"?document.querySelector(c):c,Kt=async(c,m,x,v)=>{const b=he(v),k=b.publicKey||f.publicKey,H=b.blockHeadless||f.blockHeadless,C=f.storageProvider||b.storageProvider,L={...f.blockList,...b.blockList},I={...f.limitRate,...b.limitRate};if(H&&Fe(navigator))return Promise.reject($e());const T=Lt(x);_e(k,c,m),Ot(T);const P=new FormData(T);return He(L,P)?Promise.reject(We()):await Ve(location.pathname,I,C)?Promise.reject(ze()):(P.append("lib_version","4.4.1"),P.append("service_id",c),P.append("template_id",m),P.append("user_id",k),Ke("/api/v1.0/email/send-form",P))},_t={init:It,send:Mt,sendForm:Kt,EmailJSResponseStatus:V},Ft={"Appointment Schedule":[{id:1,title:"Discussing Goods Price",customer:"Big C Supercenter PLC",amount:0,currency:"฿",priority:"none",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]}],"Presentation Schedule":[{id:2,title:"Selling New Machines",customer:"SIANGHAI EITING TRADING COMPANY",amount:5e4,currency:"฿",priority:"high",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+45*24*60*60*1e3).toISOString().split("T")[0]}],Quotation:[{id:3,title:"Introduced New Plan about Manufacturing",customer:"METRO MACHINERY",amount:100,currency:"฿",priority:"medium",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+20*24*60*60*1e3).toISOString().split("T")[0]}],Demo:[],Decision:[],Connection:[],"Contract Sent":[],"Close Won":[{id:4,title:"Negotiated and made contract",customer:"Konvy",amount:8e4,currency:"฿",priority:"low",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0]}]},Le=[{name:"EIT LASERTECHNIK (Einstein Industrie Technik)",contact:"Sales Team",email:"sales@eitlaser.com",phone:"02-052-9544",address:"1/120 Ramkamhaeng Soi 184, Minburi, Minburi, Bangkok 10510",taxId:""},{name:"PTT Public Company Limited",contact:"Auttapol Rerkpiboon",email:"auttapol.r@pttplc.com",phone:"02-537-2000",address:"555 Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107544000108"},{name:"SCG (Siam Cement Group)",contact:"Roongrote Rangsiyopash",email:"roongrote.r@scg.com",phone:"02-586-3333",address:"1 Siam Cement Rd, Bang Sue, Bangkok 10800",taxId:"0107537000114"},{name:"CP All Public Company Limited",contact:"Korsak Chairasmisak",email:"korsak.c@cpall.co.th",phone:"02-071-9000",address:"313 C.P. Tower, Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107542000011"},{name:"Advanced Info Service (AIS)",contact:"Somchai Lertsutiwong",email:"somchai.l@ais.co.th",phone:"02-029-5000",address:"414 Phaholyothin Rd, Phaya Thai, Bangkok 10400",taxId:"0107535000265"},{name:"Kasikornbank",contact:"Kattiya Indaravijaya",email:"kattiya.i@kasikornbank.com",phone:"02-888-8888",address:"400/22 Phahon Yothin Rd, Phaya Thai, Bangkok 10400",taxId:"0107536000315"},{name:"Siam Commercial Bank",contact:"Arthid Nanthawithaya",email:"arthid.n@scb.co.th",phone:"02-777-7777",address:"9 Ratchadapisek Rd, Chatuchak, Bangkok 10900",taxId:"0107536000102"},{name:"Bangkok Bank",contact:"Chartsiri Sophonpanich",email:"chartsiri.s@bangkokbank.com",phone:"1333",address:"333 Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107536000374"},{name:"True Corporation",contact:"Manat Manavutiveth",email:"manat.m@truecorp.co.th",phone:"1242",address:"18 True Tower, Ratchadaphisek Rd, Huai Khwang, Bangkok 10310",taxId:"0107536000081"},{name:"Thai Beverage",contact:"Thapana Sirivadhanabhakdi",email:"thapana.s@thaibev.com",phone:"02-785-5555",address:"14 Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107546000342"},{name:"Central Retail Corporation",contact:"Yol Phokasub",email:"yol.p@central.co.th",phone:"02-650-3600",address:"22 Soi Somkid, Ploenchit Rd, Pathum Wan, Bangkok 10330",taxId:"0107562000386"},{name:"Charoen Pokphand Foods",contact:"Prasit Boondoungprasert",email:"prasit.b@cpf.co.th",phone:"02-766-8000",address:"313 C.P. Tower, Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107537000246"},{name:"PTT Exploration and Production",contact:"Montri Rawanchaikul",email:"montri.r@pttep.com",phone:"02-537-4000",address:"555/1 Energy Complex, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107535000206"},{name:"Airports of Thailand",contact:"Nitinai Sirismatthakarn",email:"nitinai.s@aot.co.th",phone:"02-535-1111",address:"333 Cherdwutagard Rd, Don Mueang, Bangkok 10210",taxId:"0107545000292"},{name:"Energy Absolute",contact:"Somphote Ahunai",email:"somphote.a@energyabsolute.co.th",phone:"02-248-2455",address:"89 AIA Capital Center, Ratchadaphisek Rd, Din Daeng, Bangkok 10400",taxId:"0107551000061"},{name:"Gulf Energy Development",contact:"Sarath Ratanavadi",email:"sarath.r@gulf.co.th",phone:"02-080-4499",address:"87 M. Thai Tower, All Seasons Place, Wireless Rd, Pathum Wan, Bangkok 10330"},{name:"Intouch Holdings",contact:"Kim Siritaweechai",email:"kim.s@intouchcompany.com",phone:"02-118-6900",address:"87 M. Thai Tower, All Seasons Place, Wireless Rd, Pathum Wan, Bangkok 10330"},{name:"Minor International",contact:"William Heinecke",email:"william.h@minor.com",phone:"02-365-7500",address:"88 The Parq Building, Ratchadaphisek Rd, Khlong Toei, Bangkok 10110"},{name:"Indorama Ventures",contact:"Aloke Lohia",email:"aloke.l@indorama.net",phone:"02-661-6661",address:"75/102 Ocean Tower 2, Sukhumvit Soi 19, Watthana, Bangkok 10110"},{name:"Bangkok Dusit Medical Services",contact:"Poramaporn Prasarttong-Osoth",email:"poramaporn.p@bdms.co.th",phone:"02-310-3000",address:"2 Soi Soonvijai 7, New Phetchaburi Rd, Huai Khwang, Bangkok 10310"},{name:"Electricity Generating Public Company",contact:"Thepparat Theppitak",email:"thepparat.t@egco.com",phone:"02-998-5000",address:"222 Vibhavadi Rangsit Rd, Lak Si, Bangkok 10210"},{name:"Delta Electronics (Thailand)",contact:"Jackie Chang",email:"info@deltathailand.com",phone:"02-709-2800",address:"909 Soi 9, Bangpoo Ind. Estate, Samut Prakan 10280"},{name:"Global Power Synergy (GPSC)",contact:"Worawat Pitayasiri",email:"gpsc@gpscgroup.com",phone:"02-140-4600",address:"555/2 Energy Complex B, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Thai Oil",contact:"Wirat Uanarumit",email:"thayoil@thaioilgroup.com",phone:"02-797-2999",address:"555/1 Energy Complex A, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Ratch Group",contact:"Choosri Kietkajornkul",email:"ratch@ratch.co.th",phone:"02-794-9999",address:"72 Ngam Wong Wan Rd, Nonthaburi 11000"},{name:"Krung Thai Bank",contact:"Payong Srivanich",email:"call.center@krungthai.com",phone:"02-111-1111",address:"35 Sukhumvit Rd, Watthana, Bangkok 10110"},{name:"TMBThanachart Bank (TTB)",contact:"Piti Tantakasem",email:"ttb@ttbbank.com",phone:"1428",address:"3000 Phahon Yothin Rd, Chatuchak, Bangkok 10900"},{name:"PTT Global Chemical (GC)",contact:"Kongkrapan Intarajang",email:"gc@pttgcgroup.com",phone:"02-265-8400",address:"555/1 Energy Complex A, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Osotspa",contact:"Wannipa Bhakdibutr",email:"osotspa@osotspa.com",phone:"02-351-1000",address:"348 Ramkhamhaeng Rd, Bang Kapi, Bangkok 10240"},{name:"Carabao Group",contact:"Sathien Setthasit",email:"carabao@carabaogroup.com",phone:"02-636-6111",address:"393 Silom Rd, Bang Rak, Bangkok 10500"},{name:"B.Grimm Power",contact:"Harald Link",email:"bgrimm@bgrimmpower.com",phone:"02-710-3000",address:"5 Krungthepkreetha Rd, Bang Kapi, Bangkok 10240"},{name:"Banpu",contact:"Somruedee Chaimongkol",email:"banpu@banpu.co.th",phone:"02-694-6600",address:"1550 Thanapoom Tower, Phetchaburi Rd, Ratchathewi, Bangkok 10400"},{name:"Berli Jucker (BJC)",contact:"Aswin Techajareonvikul",email:"bjc@bjc.co.th",phone:"02-367-1111",address:"99 Soi Rubia, Sukhumvit 42, Khlong Toei, Bangkok 10110"},{name:"Home Product Center (HomePro)",contact:"Khunawut Thumpomkul",email:"contact@homepro.co.th",phone:"1284",address:"96/27 Moo 9 Bang Khen, Mueang Nonthaburi, Nonthaburi 11000"},{name:"Land and Houses",contact:"Naporn Sunthornchitcharoen",email:"lh@lh.co.th",phone:"1198",address:"1 Q. House Lumpini, Sathon Tai Rd, Sathon, Bangkok 10120"},{name:"Supalai",contact:"Prateep Tangmatitham",email:"supalai@supalai.com",phone:"1720",address:"1011 Supalai Grand Tower, Rama 3 Rd, Yan Nawa, Bangkok 10120"},{name:"AP (Thailand)",contact:"Anuphong Assavabhokhin",email:"ap@apthai.com",phone:"1623",address:"170/57 Ocean Tower 1, Ratchadaphisek Rd, Khlong Toei, Bangkok 10110"},{name:"Sansiri",contact:"Apichet Bunyakiet",email:"sansiri@sansiri.com",phone:"1685",address:"475 Siripinyo Bldg, Si Ayutthaya Rd, Ratchathewi, Bangkok 10400"},{name:"Central Pattana (CPN)",contact:"Wallaya Chirathivat",email:"cpn@centralpattana.co.th",phone:"02-667-5555",address:"999/9 Rama 1 Rd, Pathum Wan, Bangkok 10330"},{name:"MK Restaurant Group",contact:"Rit Thirakomen",email:"mk@mkrestaurantgroup.com",phone:"02-836-1000",address:"1200 Debaratna Rd, Bang Na, Bangkok 10260"},{name:"Siam Makro (CP Axtra)",contact:"Saowaluck Thithapant",email:"cpaxtra@cpaxtra.co.th",phone:"02-067-8999",address:"1468 Phatthanakan Rd, Suan Luang, Bangkok 10250"},{name:"Thai Union Group",contact:"Thiraphong Chansiri",email:"tu@thaiunion.com",phone:"02-298-0024",address:"72/1 Moo 7 Sethakit 1 Rd, Mueang Samut Sakhon, Samut Sakhon 74000"},{name:"Sri Trang Agro-Industry",contact:"Viyavood Sincharoenkul",email:"sta@sritranggroup.com",phone:"02-207-4500",address:"10 Soi 10, Phetkasem Rd, Hat Yai, Songkhla 90110"},{name:"KCE Electronics",contact:"Bancha Ongkosit",email:"kce@kce.co.th",phone:"02-326-0196",address:"72-72/1-3 Lat Krabang Ind. Estate, Lat Krabang, Bangkok 10520"},{name:"Hana Microelectronics",contact:"Richard Han",email:"hana@hanagroup.com",phone:"02-551-1297",address:"10/4 Moo 3, Vibhavadi Rangsit Rd, Lak Si, Bangkok 10210"},{name:"Muangthai Capital",contact:"Chuchat Petaumpai",email:"mtc@muangthaicap.com",phone:"02-483-8888",address:"32/1 Charan Sanitwong Rd, Bang Phlat, Bangkok 10700"},{name:"Srisawad Corporation",contact:"Chatchai Kaewbootta",email:"sawad@srisawad.com",phone:"1652",address:"99/392 Chaeng Watthana Rd, Lak Si, Bangkok 10210"},{name:"VGI",contact:"Nelson Leung",email:"vgi@vgi.co.th",phone:"02-273-8884",address:"21 TST Tower, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Plan B Media",contact:"Palin Lojanagosin",email:"planb@planbmedia.co.th",phone:"02-530-8053",address:"1213/420 Soi Lat Phrao 94, Wang Thonglang, Bangkok 10310"},{name:"BTS Group Holdings",contact:"Keeree Kanjanapas",email:"bts@bts.co.th",phone:"02-617-7300",address:"21 Phahon Yothin Rd, Chatuchak, Bangkok 10900"},{name:"Bangkok Expressway and Metro (BEM)",contact:"Sombat Kitjalaksana",email:"bem@bemplc.co.th",phone:"02-641-4611",address:"587 Sutthisan Winitchai Rd, Din Daeng, Bangkok 10400"}],O="http://localhost:8001/api";function $t(){const[c,m]=p.useState(Object.keys(Ft).map((t,a)=>({id:a+1,name:t,deals:[]}))),[x,v]=p.useState(null),[b,k]=p.useState(null),[H,C]=p.useState(!1);p.useEffect(()=>{L()},[]);const L=async()=>{try{const t=localStorage.getItem("authToken"),a=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${O}/deals/`,{headers:a});if(!s.ok)throw new Error("Failed to fetch deals");const n=await s.json();m(r=>{const l=r.map(o=>({...o,deals:[]}));return n.forEach(o=>{const i={id:o.id,title:o.title,customer:o.customer,amount:Number(o.amount),currency:o.currency,priority:o.priority,contact:o.contact,email:o.email,phone:o.phone,notes:o.notes,createdAt:o.created_at,expectedClose:o.expected_close,activitySchedules:(o.activity_schedules||[]).map(g=>({id:g.id,dueAt:g.due_at?g.due_at.slice(0,16):"",text:g.text}))},d=l.findIndex(g=>g.name===o.stage);d>=0?l[d].deals.push(i):l.length>0&&l[0].deals.push(i)}),l})}catch(t){console.error("Error loading deals:",t)}},[I,T]=p.useState(null),[P,pe]=p.useState(""),[ge,xe]=p.useState(""),[be,fe]=p.useState(""),[ve,ye]=p.useState(""),[we,ke]=p.useState(""),[je,Ne]=p.useState(""),[K,_]=p.useState(null),z={company:"",contact:"",opportunity:"",email:"",phone:"",address:"",taxId:"",amount:0,currency:"฿",priority:"none",stageIndex:0},[h,w]=p.useState(z),[u,ee]=p.useState(null),[Se,G]=p.useState(""),[Ce,J]=p.useState(""),[R,U]=p.useState(null),[E,te]=p.useState(null),[Ge,Y]=p.useState(null),ae=p.useRef(null),[Je,se]=p.useState(!1),[A,ne]=p.useState(null),[y,De]=p.useState(null),[Ht,Ie]=p.useState({show:!1,message:""}),[oe,Ue]=p.useState(null),[q,Te]=p.useState(!1),[Ye,Q]=p.useState(!1),[M,F]=p.useState(null),[re,Pe]=p.useState(""),[le,Re]=p.useState(""),[Ae,Be]=p.useState(!1),[j,X]=p.useState(()=>{try{return JSON.parse(localStorage.getItem("email_config"))||{serviceId:"",templateId:"",publicKey:""}}catch{return{serviceId:"",templateId:"",publicKey:""}}}),[ie,ce]=p.useState(!1),qe=t=>{X(t),localStorage.setItem("email_config",JSON.stringify(t)),ce(!1),B("Email settings saved")},B=t=>{Ie({show:!0,message:t}),setTimeout(()=>Ie({show:!1,message:""}),3e3)},Ee=(t,a="info",s="",n="")=>{try{const r=JSON.parse(localStorage.getItem("notifications")||"[]");r.unshift({id:Date.now(),message:t,timestamp:new Date().toISOString(),unread:!0,type:a,company:s||"",source:n||""}),r.length>50&&(r.length=50),localStorage.setItem("notifications",JSON.stringify(r)),window.dispatchEvent(new Event("storage"))}catch{}},Qe=t=>t.reduce((a,s)=>a+(s.amount||0),0),Xe=t=>{const a=(t.activitySchedules||[]).map(l=>new Date(l.dueAt??l.startAt).getTime()).filter(l=>Number.isFinite(l));if(!a.length)return null;const s=Date.now(),n=a.filter(l=>l>=s),r=n.length?n:a;return Math.min(...r)},Ze=t=>{const a=(t.activitySchedules||[]).map(i=>({s:i,t:new Date(i.dueAt??i.startAt).getTime()})).filter(i=>Number.isFinite(i.t));if(!a.length)return null;const s=Date.now(),n=a.filter(i=>i.t>=s),r=n.length?n:a,l=Math.min(...r.map(i=>i.t)),o=r.find(i=>i.t===l)||a.find(i=>i.t===l);return o?o.s:null},et=t=>{const a=(t.activitySchedules||[]).map(s=>new Date(s.dueAt??s.startAt).getTime()).filter(s=>Number.isFinite(s));return a.length?Math.max(...a):null},tt=t=>{const a=t.createdAt?new Date(t.createdAt).getTime():null;return Number.isFinite(a)?a:null},at=t=>{const a=t.expectedClose?new Date(t.expectedClose).getTime():null;return Number.isFinite(a)?a:null},st=(t,a,s)=>{if(!a)return t;const n=l=>a==="createdAt"?tt(l):a==="lastActivity"?et(l):a==="expectedClose"?at(l):null,r=t.map(l=>({d:l,k:n(l)}));return r.sort((l,o)=>{const i=l.k??(s?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),d=o.k??(s?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY);return s?i-d:d-i}),r.map(l=>l.d)},Me=t=>{if(!t)return!1;const a=new Date(t),s=new Date,n=new Date(s);n.setHours(0,0,0,0);const l=(n.getDay()+6)%7,o=new Date(n);o.setDate(n.getDate()-l);const i=new Date(o);return i.setDate(o.getDate()+6),a>=o&&a<=i},nt=t=>{const a=String(t).trim();return a?a.charAt(0).toUpperCase()+a.slice(1):""},W=(t,a,s)=>{m(n=>n.map((r,l)=>{if(l!==t)return r;const o=r.deals.map((i,d)=>d===a?s(i):i);return{...r,deals:o}}))},ot=async(t,a,s,n)=>{const r=c[t].deals[a],l=Date.now(),o={id:l,dueAt:s,text:n};m(i=>i.map((d,g)=>{if(g!==t)return d;const N=d.deals.map((S,D)=>D===a?{...S,activitySchedules:[...S.activitySchedules||[],o]}:S);return{...d,deals:N}}));try{const i=localStorage.getItem("authToken"),d={"Content-Type":"application/json",...i?{Authorization:`Token ${i}`}:{}},g=await fetch(`${O}/activity_schedules/`,{method:"POST",headers:d,body:JSON.stringify({deal:r.id,due_at:s,text:n})});if(!g.ok)throw new Error("Failed to add schedule");const N=await g.json();m(S=>S.map((D,$)=>{if($!==t)return D;const de=D.deals.map((ue,kt)=>{if(kt!==a)return ue;const jt=(ue.activitySchedules||[]).map(me=>me.id===l?{...me,id:N.id}:me);return{...ue,activitySchedules:jt}});return{...D,deals:de}}))}catch(i){console.error("Failed to add schedule",i)}},rt=async(t,a,s,n)=>{const l=c[t].deals[a].activitySchedules[s];if(l.id){m(o=>o.map((i,d)=>{if(d!==t)return i;const g=i.deals.map((N,S)=>{if(S!==a)return N;const D=N.activitySchedules.map(($,de)=>de===s?{...$,...n}:$);return{...N,activitySchedules:D}});return{...i,deals:g}}));try{const o=localStorage.getItem("authToken"),i={"Content-Type":"application/json",...o?{Authorization:`Token ${o}`}:{}},d={};n.dueAt!==void 0&&(d.due_at=n.dueAt),n.text!==void 0&&(d.text=n.text),await fetch(`${O}/activity_schedules/${l.id}/`,{method:"PATCH",headers:i,body:JSON.stringify(d)})}catch(o){console.error("Failed to update schedule",o)}}},lt=(t,a,s,n)=>{s===n||s==null||n==null||W(t,a,r=>{const l=[...r.activitySchedules||[]],[o]=l.splice(s,1);return l.splice(n,0,o),{...r,activitySchedules:l}})},it=(t,a,s)=>{W(t,a,n=>{const r=[...n.activitySchedules||[]];if(s<=0)return n;const l=r[s-1];return r[s-1]=r[s],r[s]=l,{...n,activitySchedules:r}})},ct=(t,a,s)=>{W(t,a,n=>{const r=[...n.activitySchedules||[]];if(s>=r.length-1)return n;const l=r[s+1];return r[s+1]=r[s],r[s]=l,{...n,activitySchedules:r}})},dt=(t,a)=>{const s=c[t].deals[a];pe(s.notes||""),xe(s.contact||""),fe(s.email||""),ye(s.phone||""),ke(s.address||""),Ne(s.taxId||""),T({stageIndex:t,cardIndex:a})},ut=async()=>{if(!I)return;const{stageIndex:t,cardIndex:a}=I;m(s=>s.map((n,r)=>{if(r!==t)return n;const l=n.deals.map((o,i)=>i===a?{...o,notes:P,contact:ge,email:be,phone:ve,address:we,taxId:je}:o);return{...n,deals:l}})),T(null)},mt=(t,a)=>{const s=c[t].deals[a];F({stageIndex:t,cardIndex:a,to:s.email||""}),Pe(`Regarding: ${s.title}`),Re(`Dear ${s.contact||"Partner"},

`)},ht=(t,a,s)=>{s.dataTransfer.setData("card",JSON.stringify({stageIndex:t,cardIndex:a}))},pt=async(t,a)=>{const s=a.dataTransfer.getData("card");if(!s)return;const{stageIndex:n,cardIndex:r}=JSON.parse(s);if(n===t)return;const l=c[n].deals[r];if(l){const o=c[n].name,i=c[t].name,d=String(i||"").toLowerCase(),g=d.includes("close")&&d.includes("won"),N=`CRM: Moved "${l.title}" from ${o} --> ${i}`,S=g?`${N} — Create PO or Receive PO`:N;B(S),Ee(S,g?"success":"info",l.customer||"","CRM")}m(o=>{const i=o.map(g=>({...g,deals:[...g.deals]})),[d]=i[n].deals.splice(r,1);return i[t].deals.push(d),i})},Oe=(t,a)=>{try{a.dataTransfer.setDragImage(a.currentTarget,40,20)}catch{}a.dataTransfer.setData("stage",String(t))},gt=(t,a)=>{const s=a.dataTransfer.getData("stage");if(s==="")return;const n=Number(s);n!==t&&m(r=>{const l=r.map(i=>({...i,deals:[...i.deals]})),[o]=l.splice(n,1);return l.splice(t,0,o),l})},xt=t=>{const a=c[t],s=window.prompt("Edit stage name",a.name);s&&(m(n=>n.map((r,l)=>l===t?{...r,name:s}:r)),v(null))},bt=t=>{c.length<=1||!window.confirm("Delete this stage? Deals inside will be removed.")||(m(s=>s.filter((n,r)=>r!==t)),v(null))},ft=()=>{const t=window.prompt("New stage name");t&&m(a=>[...a,{id:Date.now(),name:t,deals:[]}])},Z=async(t,a,s)=>{const n=c[t].deals[a];m(r=>r.map((l,o)=>{if(o!==t)return l;const i=l.deals.map((d,g)=>g===a?{...d,priority:s}:d);return{...l,deals:i}})),k(null),_(null);try{const r=localStorage.getItem("authToken"),l={"Content-Type":"application/json",...r?{Authorization:`Token ${r}`}:{}};await fetch(`${O}/deals/${n.id}/`,{method:"PATCH",headers:l,body:JSON.stringify({priority:s})})}catch(r){console.error("Failed to update priority",r)}},vt=async(t,a)=>{const n=c[t].deals[a],r=window.prompt("Edit opportunity title",n.title);if(r===null)return;const l=window.prompt("Edit customer",n.customer);if(l===null)return;const o=window.prompt("Edit amount (number)",String(n.amount??0));if(o===null)return;const i=o.trim()===""?n.amount:Number(o);if(!Number.isFinite(i)){alert("Amount must be a number");return}m(d=>d.map((g,N)=>{if(N!==t)return g;const S=g.deals.map((D,$)=>$===a?{...D,title:r,customer:l,amount:i}:D);return{...g,deals:S}})),k(null);try{const d=localStorage.getItem("authToken"),g={"Content-Type":"application/json",...d?{Authorization:`Token ${d}`}:{}};await fetch(`${O}/deals/${n.id}/`,{method:"PATCH",headers:g,body:JSON.stringify({title:r,customer:l,amount:i})})}catch(d){console.error("Failed to update deal",d)}},yt=async(t,a)=>{if(!window.confirm("Delete this opportunity?"))return;const n=c[t].deals[a].id;m(r=>r.map((l,o)=>{if(o!==t)return l;const i=l.deals.filter((d,g)=>g!==a);return{...l,deals:i}})),k(null);try{const r=localStorage.getItem("authToken"),l=r?{Authorization:`Token ${r}`}:{};await fetch(`${O}/deals/${n}/`,{method:"DELETE",headers:l})}catch(r){console.error("Failed to delete deal",r)}},wt=t=>{switch(t){case"Appointment Schedule":return 10;case"Presentation Schedule":return 25;case"Quotation":return 40;case"Demo":return 55;case"Decision":return 75;case"Connection":return 90;case"Close Won":return 100;default:return 10}};return e.jsxs("main",{className:"min-h-screen bg-white font-sans text-gray-900",children:[e.jsx(St,{}),e.jsx("div",{className:"border-b border-slate-200 bg-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2 cursor-pointer",children:"Deals"}),e.jsx("div",{className:"h-6 w-px bg-slate-200 hidden sm:block"}),e.jsxs("select",{className:"bg-transparent border-none text-sm font-medium text-slate-600 hover:text-slate-900 focus:ring-0 cursor-pointer",children:[e.jsx("option",{children:"Talent Acquisition"}),e.jsx("option",{children:"Sales Pipeline"})]}),e.jsxs("select",{className:"bg-transparent border-none text-sm font-medium text-slate-600 hover:text-slate-900 focus:ring-0 cursor-pointer",children:[e.jsx("option",{children:"All deals"}),e.jsx("option",{children:"My deals"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition-colors shadow-sm",children:"Import"}),e.jsx("button",{onClick:()=>{w(z),C(!0)},className:"px-5 py-2 text-sm font-medium text-white bg-[#2D4485] rounded-lg hover:bg-[#3D56A6] shadow-md transition-all hover:shadow-lg transform hover:-translate-y-0.5",children:"+ Create deal"})]})]})}),e.jsx("div",{className:"border-b border-slate-200 bg-white px-6 py-3 flex items-center justify-between flex-wrap gap-4 shadow-sm z-10 relative",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1 flex-wrap",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",placeholder:"Search deals...",className:"pl-10 pr-4 py-2 border border-slate-200 rounded-lg text-sm w-64 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all bg-slate-50 focus:bg-white"}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400 group-focus-within:text-[#2D4485] transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-slate-600 overflow-x-auto",children:[{label:"Create date",key:"createdAt"},{label:"Last activity",key:"lastActivity"},{label:"Close date",key:"expectedClose"}].map(t=>{const a=oe===t.key;return e.jsxs("button",{className:`px-3 py-1.5 rounded-lg whitespace-nowrap transition-colors flex items-center gap-1 ${a?"bg-slate-100 text-slate-900":"hover:bg-slate-100 hover:text-slate-900"}`,onClick:()=>{oe===t.key?Te(!q):(Ue(t.key),Te(!1))},title:`Sort by ${t.label}${a?q?" (asc)":" (desc)":""}`,children:[t.label," ",e.jsx("span",{className:"text-[10px] opacity-50",children:a&&q?"▲":"▼"})]},t.key)})})]})}),e.jsxs("section",{className:"w-full overflow-x-auto h-[calc(100vh-140px)] bg-slate-50",children:[e.jsxs("div",{className:"flex h-full p-6 gap-6",children:[c.map((t,a)=>{const s=Qe(t.deals),n=wt(t.name),r=s*(n/100),l=st(t.deals,oe,q);return e.jsxs("div",{className:"w-80 min-w-[20rem] flex flex-col h-full bg-slate-100/50 rounded-2xl border border-slate-200/60 group",draggable:!0,onDragStart:o=>Oe(a,o),onDragOver:o=>o.preventDefault(),onDrop:o=>{o.dataTransfer.getData("card")?pt(a,o):o.dataTransfer.getData("stage")!==""&&gt(a,o)},children:[e.jsxs("div",{className:"p-4 text-center border-b border-slate-200/60 cursor-grab active:cursor-grabbing bg-transparent group/header relative",draggable:!0,onDragStart:o=>Oe(a,o),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-bold text-slate-700 uppercase text-xs tracking-wider",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-500 text-xs font-medium bg-slate-200/60 px-2 py-0.5 rounded-full",children:t.deals.length}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 opacity-0 group-hover/header:opacity-100 transition-opacity",onClick:o=>{o.stopPropagation(),v(x===a?null:a)},children:"⋯"})]})]}),x===a&&e.jsxs("div",{className:"absolute right-2 top-8 bg-white border border-slate-200 rounded-lg shadow-xl z-30 w-32 text-left py-1",children:[e.jsx("button",{className:"block w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50",onClick:()=>xt(a),children:"Edit Stage"}),e.jsx("button",{className:"block w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50 text-red-600",onClick:()=>bt(a),children:"Delete Stage"})]}),e.jsx("div",{className:"h-1 w-full bg-slate-200 rounded-full overflow-hidden mt-3",children:e.jsx("div",{className:"h-full bg-[#2D4485]/60",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[l.map((o,i)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-slate-200 p-4 mb-3 hover:shadow-md hover:ring-[#2D4485]/30 transition-all cursor-grab relative group/card",draggable:!0,onDragStart:d=>ht(a,i,d),children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-blue-50 text-[#2D4485] text-sm font-semibold border border-blue-100 cursor-pointer hover:bg-blue-100 transition-colors",onClick:d=>{d.stopPropagation(),mt(a,i)},title:"Click to send email",children:[e.jsx("svg",{className:"w-4 h-4 text-[#2D4485]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{className:"truncate text-xs leading-tight max-w-[280px]",children:o.customer})]})}),e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-3",children:[e.jsx("h4",{className:"font-semibold text-slate-800 text-sm leading-snug hover:text-[#2D4485] cursor-pointer transition-colors",onClick:()=>dt(a,i),children:o.title}),e.jsx("button",{className:"text-slate-300 hover:text-slate-500 opacity-0 group-hover/card:opacity-100 transition-opacity p-1 hover:bg-slate-50 rounded",onClick:d=>{d.stopPropagation(),k({stageIndex:a,cardIndex:i})},children:"⋯"})]}),e.jsx("div",{className:"space-y-2 mb-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-900 font-bold text-sm",children:[e.jsx("span",{className:"text-xs font-normal text-slate-400",children:o.currency}),o.amount.toLocaleString()]})}),e.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 mt-2",children:e.jsxs("div",{className:"flex items-center gap-2 relative",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] text-white font-bold shadow-sm ${o.priority==="high"?"bg-red-500 ring-2 ring-red-100":o.priority==="medium"?"bg-orange-400 ring-2 ring-orange-100":"bg-[#2D4485] ring-2 ring-blue-100"} cursor-pointer hover:scale-110 transition-transform`,onClick:d=>{d.stopPropagation();const g=K&&K.stageIndex===a&&K.cardIndex===i;_(g?null:{stageIndex:a,cardIndex:i})},title:`Priority: ${o.priority}`,children:o.customer.charAt(0)}),K&&K.stageIndex===a&&K.cardIndex===i&&e.jsxs("div",{className:"absolute left-0 bottom-8 bg-white border border-slate-200 rounded-lg shadow-xl z-20 w-32 py-1",children:[e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:d=>{d.stopPropagation(),Z(a,i,"low"),_(null)},children:"Low"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:d=>{d.stopPropagation(),Z(a,i,"medium"),_(null)},children:"Medium"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:d=>{d.stopPropagation(),Z(a,i,"high"),_(null)},children:"High"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:d=>{d.stopPropagation(),Z(a,i,"none"),_(null)},children:"None"})]}),e.jsx("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-slate-50 rounded px-1.5 py-0.5 transition-colors",onClick:d=>{d.stopPropagation(),ee(u&&u.stageIndex===a&&u.cardIndex===i?null:{stageIndex:a,cardIndex:i})},children:(()=>{const d=Ze(o);return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${Me(d.dueAt)?"bg-green-500":"bg-slate-300"}`}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium truncate max-w-[80px]",children:nt(d.text||"Activity")})]}):e.jsx(e.Fragment,{children:e.jsx("svg",{className:"w-3.5 h-3.5 text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})})()})]})}),b&&b.stageIndex===a&&b.cardIndex===i&&e.jsxs("div",{className:"absolute right-2 top-8 z-10 w-32 bg-white rounded-lg shadow-xl border border-slate-200 py-1",children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",onClick:()=>vt(a,i),children:"Edit"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-slate-50",onClick:()=>yt(a,i),children:"Delete"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",onClick:()=>k(null),children:"Close"})]})]},o.id)),e.jsxs("button",{onClick:()=>{w({...z,stageIndex:a}),C(!0)},className:"w-full py-2.5 mt-2 text-sm font-medium text-slate-500 hover:text-[#2D4485] hover:bg-slate-200/50 rounded-lg border border-transparent hover:border-slate-200 transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg leading-none",children:"+"})," New deal"]})]}),e.jsx("div",{className:"p-3 border-t border-slate-200/60 bg-slate-50/50 rounded-b-2xl",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsxs("div",{className:"text-sm text-slate-700 font-semibold",children:["Total: ",s.toLocaleString()," ฿"]}),e.jsxs("div",{className:"text-xs text-slate-400 mt-0.5 font-medium",children:["Weighted: ",r.toLocaleString()," ฿"]})]})})]},t.id)}),e.jsx("div",{className:"w-80 shrink-0 p-4",children:e.jsx("button",{onClick:ft,className:"w-full py-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 font-medium hover:border-[#2D4485] hover:text-[#2D4485] hover:bg-[#2D4485]/5 transition-all",children:"+ Add Stage"})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>ee(null),children:e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[560px]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-full max-w-xl mx-4",tabIndex:0,ref:t=>{t&&(ae.current=t)},onKeyDown:t=>{const a=t.target&&t.target.tagName;if(a==="INPUT"||a==="TEXTAREA")return;const s=R&&u&&R.stageIndex===u.stageIndex&&R.cardIndex===u.cardIndex?R.idx:null;if(s!=null){if(t.key==="ArrowUp")t.preventDefault(),s>0&&(it(u.stageIndex,u.cardIndex,s),U({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s-1}));else if(t.key==="ArrowDown"){t.preventDefault();const n=(c[u.stageIndex].deals[u.cardIndex].activitySchedules||[]).length;s<n-1&&(ct(u.stageIndex,u.cardIndex,s),U({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s+1}))}}},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Next Activity"}),(()=>{const t=c[u.stageIndex].deals[u.cardIndex],a=Xe(t);return Me(a)?e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-blue-50 text-[#2D4485] text-xs font-medium border border-blue-100",children:"This week"}):null})(),e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-medium border border-slate-200",children:(()=>{const t=c[u.stageIndex].deals[u.cardIndex];return(t.activitySchedules||[]).length?`${(t.activitySchedules||[]).length} scheduled`:"No schedules"})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-slate-200 bg-white text-slate-600 hover:bg-slate-50 hover:border-slate-300 transition-colors",onClick:()=>{se(!0),G(""),J("")},title:"Add schedule",children:"+"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>ee(null),children:"✕"})]})]}),e.jsx("div",{className:"p-6 space-y-4",children:(()=>{const t=c[u.stageIndex].deals[u.cardIndex];return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[(t.activitySchedules||[]).map((a,s)=>e.jsxs("div",{className:`flex flex-wrap items-center gap-3 bg-white border border-slate-200 rounded-xl p-3 shadow-sm ${R&&u&&R.stageIndex===u.stageIndex&&R.cardIndex===u.cardIndex&&R.idx===s?"ring-2 ring-[#2D4485]/20 border-[#2D4485]":""} ${Ge===s?"ring-2 ring-blue-300":""} ${y&&y.stageIndex===u.stageIndex&&y.cardIndex===u.cardIndex&&y.idx===s?"cursor-default":"cursor-grab active:cursor-grabbing hover:border-slate-300"}`,onClick:n=>{const r=n.target&&n.target.tagName;r==="INPUT"||r==="TEXTAREA"||r==="BUTTON"||(U({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s}),ae.current&&ae.current.focus())},draggable:!0,onDragStart:n=>{const r=n.target,l=r&&r.tagName,o=l==="INPUT"||l==="TEXTAREA"||l==="BUTTON",i=!!(y&&y.stageIndex===u.stageIndex&&y.cardIndex===u.cardIndex&&y.idx===s);if(o||i){n.preventDefault();return}te({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s}),Y(s),n.dataTransfer.effectAllowed="move"},onDragOver:n=>{n.preventDefault(),E&&E.stageIndex===u.stageIndex&&E.cardIndex===u.cardIndex&&Y(s)},onDrop:n=>{n.preventDefault(),E&&E.stageIndex===u.stageIndex&&E.cardIndex===u.cardIndex&&(lt(u.stageIndex,u.cardIndex,E.idx,s),U({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s})),te(null),Y(null)},onDragEnd:()=>{te(null),Y(null)},children:[e.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Due"}),(()=>{const n=!!(y&&y.stageIndex===u.stageIndex&&y.cardIndex===u.cardIndex&&y.idx===s);return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"datetime-local",value:a.dueAt||"",onChange:r=>{const{stageIndex:l,cardIndex:o}=u;W(l,o,i=>({...i,activitySchedules:(i.activitySchedules||[]).map((d,g)=>g===s?{...d,dueAt:r.target.value}:d)}))},disabled:!n,className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 w-[200px] text-sm disabled:bg-slate-50 disabled:text-slate-500 disabled:border-transparent focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"}),e.jsx("input",{type:"text",value:a.text||"",onChange:r=>{const{stageIndex:l,cardIndex:o}=u;rt(l,o,s,{text:r.target.value})},placeholder:"Details",className:"flex-1 min-w-[160px] rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors",onClick:()=>{const r=A&&A.stageIndex===u.stageIndex&&A.cardIndex===u.cardIndex&&A.idx===s;ne(r?null:{stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s})},title:"Options",children:"⋮"}),A&&A.stageIndex===u.stageIndex&&A.cardIndex===u.cardIndex&&A.idx===s&&e.jsxs("div",{className:"absolute right-0 mt-1 bg-white border border-slate-200 rounded-lg shadow-xl z-10 overflow-hidden w-32",children:[e.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors",onClick:()=>{De({stageIndex:u.stageIndex,cardIndex:u.cardIndex,idx:s}),ne(null)},children:"Edit"}),e.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm hover:bg-red-50 text-red-600 transition-colors",onClick:()=>{const{stageIndex:r,cardIndex:l}=u;W(r,l,o=>({...o,activitySchedules:(o.activitySchedules||[]).filter((i,d)=>d!==s)})),ne(null),y&&y.stageIndex===r&&y.cardIndex===l&&y.idx===s&&De(null)},children:"Delete"})]})]})]})})()]},s)),Je&&e.jsxs("div",{className:"mt-4 animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 bg-slate-50 border border-slate-200 rounded-xl p-4 shadow-inner",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Due"}),e.jsx("input",{type:"datetime-local",value:Se,onChange:a=>G(a.target.value),className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 w-[200px] text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),e.jsx("input",{type:"text",value:Ce,onChange:a=>J(a.target.value),placeholder:"Scheduled activity details",autoFocus:!0,className:"flex-1 min-w-[160px] rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>{se(!1),G(""),J("")},children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:()=>{const a=Se;if(!a)return;const{stageIndex:s,cardIndex:n}=u;ot(s,n,a,Ce||""),se(!1),G(""),J("")},children:"Add Schedule"})]})]})]})})})()})]})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-40 transition-opacity",onClick:()=>T(null),children:e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[520px] transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Company Details"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>T(null),children:"✕"})]}),e.jsx("div",{className:"p-6",children:(c[I.stageIndex].deals[I.cardIndex],e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Contact"}),e.jsx("input",{value:ge,onChange:t=>xe(t.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Contact person"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Email"}),e.jsx("input",{value:be,onChange:t=>fe(t.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Email address"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Phone"}),e.jsx("input",{value:ve,onChange:t=>ye(t.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Phone number"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Address"}),e.jsx("input",{value:we,onChange:t=>ke(t.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Company address"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Tax ID"}),e.jsx("input",{value:je,onChange:t=>Ne(t.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Tax ID"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:P,onChange:t=>pe(t.target.value),className:"w-full min-h-[120px] rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all resize-y",placeholder:"Add notes about this deal..."})]})]}))}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>T(null),children:"Cancel"}),e.jsx("button",{className:"px-6 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:ut,children:"Save Changes"})]})]})})}),H&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-30 transition-opacity",onClick:()=>C(!1),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[520px] transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"New Customer"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>C(!1),children:"✕"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Company"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:h.company,onChange:t=>{w({...h,company:t.target.value}),Q(!0)},onFocus:()=>Q(!0),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Search or enter company name..."}),Ye&&h.company&&e.jsxs("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-20 max-h-60 overflow-y-auto",children:[Le.filter(t=>t.name.toLowerCase().includes(h.company.toLowerCase())).map((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-slate-700",onClick:()=>{w({...h,company:t.name,contact:t.contact,email:t.email||"",phone:t.phone||"",address:t.address||"",taxId:t.taxId||""}),Q(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Contact: ",t.contact]})]},a)),h.company&&!Le.some(t=>t.name.toLowerCase()===h.company.toLowerCase())&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-[#2D4485] font-medium",onClick:()=>{Q(!1)},children:['+ Add "',h.company,'"']})]})]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Contact"}),e.jsx("input",{value:h.contact,onChange:t=>w({...h,contact:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Contact person"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Opportunity"}),e.jsx("input",{value:h.opportunity,onChange:t=>w({...h,opportunity:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Deal opportunity name"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Email"}),e.jsx("input",{value:h.email,onChange:t=>w({...h,email:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Email address"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Phone"}),e.jsx("input",{value:h.phone,onChange:t=>w({...h,phone:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Phone number"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Address"}),e.jsx("input",{value:h.address,onChange:t=>w({...h,address:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Company address"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Tax ID"}),e.jsx("input",{value:h.taxId,onChange:t=>w({...h,taxId:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Tax ID"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Amount"}),e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:h.currency}),e.jsx("input",{type:"number",value:h.amount,onChange:t=>w({...h,amount:Number(t.target.value)}),className:"w-full pl-10 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]}),e.jsx("input",{value:h.currency,onChange:t=>w({...h,currency:t.target.value}),className:"w-24 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all text-center uppercase"})]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Priority"}),e.jsx("div",{className:"flex items-center gap-3",children:[1,2,3].map(t=>{const a=t===1?"low":t===2?"medium":"high",s=t===1?"Low":t===2?"Medium":"High",n=h.priority===a,r=t===1?"bg-[#2D4485]":t===2?"bg-orange-400":"bg-red-500";return e.jsxs("button",{className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${n?`${r} text-white border-transparent shadow-md transform scale-105`:"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,onClick:()=>w({...h,priority:n?"none":a}),children:[s," Priority"]},t)})})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-slate-500",children:"Stage"}),e.jsx("select",{value:h.stageIndex,onChange:t=>w({...h,stageIndex:Number(t.target.value)}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",children:c.map((t,a)=>e.jsx("option",{value:a,children:t.name},t.id))})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>C(!1),children:"Cancel"}),e.jsx("button",{className:"px-6 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:async()=>{const t=c[h.stageIndex].name,a={title:h.opportunity||h.company||"Untitled",customer:h.company||h.contact||"",amount:Number(h.amount)||0,currency:h.currency||"฿",priority:h.priority||"none",contact:h.contact||"",email:h.email||"",phone:h.phone||"",address:h.address||"",tax_id:h.taxId||"",notes:"",stage:t};try{const s=localStorage.getItem("authToken"),n={"Content-Type":"application/json",...s?{Authorization:`Token ${s}`}:{}},r=await fetch(`${O}/deals/`,{method:"POST",headers:n,body:JSON.stringify(a)});if(r.ok){await L(),C(!1),w(z);try{const l=String(t).toLowerCase(),o=l.includes("close")&&l.includes("won"),i=`CRM: Created "${a.title}" in ${t}`,d=o?`${i} — Create PO or Receive PO`:i;B(d),Ee(d,o?"success":"info",a.customer||"","CRM")}catch{}}else{const l=await r.text();console.error("Failed to create deal:",l),B("Failed to create deal: "+l)}}catch(s){console.error("Error creating deal",s),B("Error creating deal: "+s.message)}},children:"Create Deal"})]})]})})}),M&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity",onClick:()=>F(null),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-slate-200",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:ie?"Email Configuration":"Send Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!ie&&e.jsx("button",{onClick:()=>ce(!0),className:"p-1.5 text-slate-400 hover:text-[#2D4485] hover:bg-blue-50 rounded-full transition-colors",title:"Configure Email Service",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),e.jsx("button",{onClick:()=>F(null),className:"text-slate-400 hover:text-slate-600 transition-colors",children:"✕"})]})]}),ie?e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-sm text-slate-600 bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4",children:["To send emails directly from this app (without opening Outlook/Mail), you need a free account from ",e.jsx("a",{href:"https://www.emailjs.com/",target:"_blank",rel:"noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:"EmailJS.com"}),".",e.jsx("br",{}),e.jsx("br",{}),"1. Sign up & Create a Service (e.g. Gmail)",e.jsx("br",{}),"2. Create an Email Template",e.jsx("br",{}),"3. Copy your keys here:"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Service ID"}),e.jsx("input",{type:"text",value:j.serviceId,onChange:t=>X({...j,serviceId:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"service_..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Template ID"}),e.jsx("input",{type:"text",value:j.templateId,onChange:t=>X({...j,templateId:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"template_..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Public Key"}),e.jsx("input",{type:"text",value:j.publicKey,onChange:t=>X({...j,publicKey:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"User ID / Public Key"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>ce(!1),className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>qe(j),className:"px-4 py-2 text-sm font-medium text-white bg-[#2D4485] hover:bg-[#3D56A6] rounded-lg shadow-sm transition-all",children:"Save Configuration"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"To"}),e.jsx("input",{type:"email",value:M.to,onChange:t=>F({...M,to:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Subject"}),e.jsx("input",{type:"text",value:re,onChange:t=>Pe(t.target.value),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Message"}),e.jsx("textarea",{rows:6,value:le,onChange:t=>Re(t.target.value),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none resize-none transition-all"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row justify-end gap-3 items-center",children:[!j.serviceId&&e.jsxs("span",{className:"text-xs text-slate-500 mr-auto max-w-[200px] leading-tight",children:["Tip: Click the gear icon ",e.jsx("span",{className:"inline-block align-middle",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})," to configure instant sending."]}),e.jsx("button",{onClick:()=>{const t=encodeURIComponent(re),a=encodeURIComponent(le.replace(/\n/g,`\r
`)),s=`mailto:${M.to}?subject=${t}&body=${a}`,n=document.createElement("a");n.href=s,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n),F(null)},className:"px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-200/50 rounded-lg transition-colors border border-transparent hover:border-slate-200",children:"Open Mail App"}),j.serviceId&&e.jsx("button",{onClick:async()=>{if(!M.to){B("Please enter an email address");return}Be(!0);try{await _t.send(j.serviceId,j.templateId,{to_email:M.to,subject:re,message:le},j.publicKey),B(`Email sent successfully to ${M.to}`),F(null)}catch(t){console.error("Email failed:",t),B("Failed to send. Check configuration.")}finally{Be(!1)}},disabled:Ae,className:"px-4 py-2 text-sm font-medium text-white bg-[#2D4485] hover:bg-[#3D56A6] rounded-lg shadow-sm hover:shadow-md transition-all flex items-center gap-2",children:Ae?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"Send Now"})]})]})]})})]})]})}Nt.createRoot(document.getElementById("root")).render(e.jsx(p.StrictMode,{children:e.jsx(Ct,{children:e.jsx($t,{})})}));
