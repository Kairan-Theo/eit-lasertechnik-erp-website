import{R as k,j as t,a as l,A as d}from"./index-BY_FY2h5.js";import{c as b,N as S}from"./navigation-BPz6xB7x.js";import{L as C}from"./language-context-CIojU0iR.js";import{T as E}from"./toaster-Bj5X1FXC.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=b("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=b("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function T(){const[n,r]=l.useState([]),[x,I]=l.useState(""),[w,m]=l.useState(!1),c=async()=>{try{const e=localStorage.getItem("authToken"),a={"Cache-Control":"no-store",...e?{Authorization:`Token ${e}`}:{}},s=await fetch(`${d}/api/notifications/`,{headers:a});if(s.ok){const i=await s.json();if(Array.isArray(i)&&i.length>0){r(i);return}}const f=JSON.parse(localStorage.getItem("notifications")||"[]").map(i=>({id:i.id,message:i.message,created_at:i.timestamp,is_read:!i.unread,type:i.type||"info"}));r(f)}catch(e){console.error("Failed to fetch notifications:",e);const s=JSON.parse(localStorage.getItem("notifications")||"[]").map(o=>({id:o.id,message:o.message,created_at:o.timestamp,is_read:!o.unread,type:o.type||"info"}));r(s)}};l.useEffect(()=>{c();const e=()=>c();window.addEventListener("notificationUpdated",e),window.addEventListener("storage",e);const a=setInterval(c,5e3);return()=>{window.removeEventListener("notificationUpdated",e),window.removeEventListener("storage",e),clearInterval(a)}},[]);const y=async e=>{r(a=>a.map(s=>s.id===e?{...s,is_read:!0}:s));try{const a=JSON.parse(localStorage.getItem("notifications")||"[]");if(a.some(s=>s.id===e)){const s=a.map(o=>o.id===e?{...o,unread:!1}:o);localStorage.setItem("notifications",JSON.stringify(s))}}catch{}try{const a=localStorage.getItem("authToken");a&&await fetch(`${d}/api/notifications/read/`,{method:"POST",headers:{Authorization:`Token ${a}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})}),window.dispatchEvent(new Event("notificationUpdated"))}catch(a){console.error("Failed to mark as read",a)}},N=async()=>{r(e=>e.map(a=>({...a,is_read:!0})));try{const a=JSON.parse(localStorage.getItem("notifications")||"[]").map(s=>({...s,unread:!1}));localStorage.setItem("notifications",JSON.stringify(a))}catch{}try{const e=localStorage.getItem("authToken");if(e){const a=n.filter(s=>!s.is_read);a.length>0&&await Promise.all(a.map(s=>fetch(`${d}/api/notifications/read/`,{method:"POST",headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"},body:JSON.stringify({id:s.id})})))}window.dispatchEvent(new Event("notificationUpdated"))}catch(e){console.error("Failed to mark all as read",e)}},v=async(e,a)=>{a&&a.stopPropagation(),r(s=>s.filter(o=>o.id!==e));try{const s=JSON.parse(localStorage.getItem("notifications")||"[]");if(s.some(o=>o.id===e)){const o=s.filter(f=>f.id!==e);localStorage.setItem("notifications",JSON.stringify(o))}}catch{}try{const s=localStorage.getItem("authToken");s&&((await fetch(`${d}/api/notifications/${e}/`,{method:"DELETE",headers:{Authorization:`Token ${s}`}})).ok||console.warn("Delete might not be implemented on backend or not found")),window.dispatchEvent(new Event("notificationUpdated"))}catch(s){console.error("Failed to delete notification",s)}},j=async()=>{r([]),m(!1);try{localStorage.setItem("notifications",JSON.stringify([]))}catch{}try{const e=localStorage.getItem("authToken");e&&await Promise.all(n.map(a=>fetch(`${d}/api/notifications/${a.id}/`,{method:"DELETE",headers:{Authorization:`Token ${e}`}}))),window.dispatchEvent(new Event("notificationUpdated"))}catch(e){console.error("Failed to clear all",e),c()}},p=l.useMemo(()=>{const e=x.trim().toLowerCase();return e?n.filter(a=>(a.message||"").toLowerCase().includes(e)):n},[n,x]),h=n.filter(e=>!e.is_read).length;return t.jsx(C,{children:t.jsxs("div",{className:"min-h-screen bg-slate-50",children:[t.jsx(S,{}),t.jsx(E,{}),t.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Notifications"}),t.jsxs("p",{className:"text-slate-500 mt-1",children:["You have ",t.jsx("span",{className:"font-semibold text-blue-600",children:h})," unread messages"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:c,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 shadow-sm",children:"Refresh"}),t.jsxs("button",{onClick:N,disabled:h===0,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                  ${h===0?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:[t.jsx(g,{className:"w-4 h-4"}),"Mark all read"]}),w?t.jsxs("div",{className:"flex items-center gap-2 bg-red-50 px-3 py-1.5 rounded-lg border border-red-100",children:[t.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Are you sure?"}),t.jsx("button",{onClick:j,className:"px-3 py-1 bg-red-600 text-white text-xs font-bold rounded hover:bg-red-700",children:"Yes"}),t.jsx("button",{onClick:()=>m(!1),className:"px-3 py-1 bg-white text-slate-600 text-xs font-bold rounded border hover:bg-slate-50",children:"No"})]}):t.jsxs("button",{onClick:()=>m(!0),disabled:n.length===0,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                    ${n.length===0?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-white text-red-600 border border-red-200 hover:bg-red-50"}`,children:[t.jsx(u,{className:"w-4 h-4"}),"Clear all"]})]})]}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:p.length===0?t.jsxs("div",{className:"p-12 text-center text-slate-400",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(g,{className:"w-8 h-8 text-slate-300"})}),t.jsx("p",{className:"text-lg font-medium text-slate-600",children:"All caught up!"}),t.jsx("p",{className:"text-sm",children:"No notifications to display"})]}):t.jsx("div",{className:"divide-y divide-slate-100",children:p.map(e=>t.jsxs("div",{onClick:()=>y(e.id),className:`p-4 hover:bg-slate-50 transition-colors cursor-pointer group flex gap-4 items-start
                      ${e.is_read?"":"bg-blue-50/50"}`,children:[t.jsx("div",{className:`mt-2 w-2 h-2 rounded-full flex-shrink-0 
                      ${e.is_read?"bg-transparent":"bg-blue-600"}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-sm ${e.is_read?"text-slate-600":"font-semibold text-slate-900"}`,children:e.message}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:new Date(e.created_at).toLocaleString()})]}),t.jsx("button",{onClick:a=>v(e.id,a),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-all",title:"Delete notification",children:t.jsx(u,{className:"w-4 h-4"})})]},e.id))})})]})]})})}k.createRoot(document.getElementById("root")).render(t.jsx(l.StrictMode,{children:t.jsx(T,{})}));
