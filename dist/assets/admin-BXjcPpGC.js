import{a as N,j as e,r as Fe,A as Z,R as Oe}from"./index-BS0Ij8SW.js";import{c as B,L as Ie,N as Ee}from"./navigation-DW0cn6Qn.js";import{P as Le}from"./purchase-order-template-k84Q1LMI.js";import{U as ie}from"./users-tmx5R9t0.js";import{L as $e}from"./language-context-BfcVNXdW.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=B("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=B("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=B("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=B("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=B("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=B("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);function Me(){const[o,r]=N.useState(""),[i,d]=N.useState({name:"",company:"",email:"",companyEmail:"",phone:"",companyPhone:""}),[x,g]=N.useState({refQuotation:"",orderDate:"",deliveryDate:"",paymentTerms:"",deliveryTo:""}),[m,v]=N.useState([{product:"",description:"",note:"",qty:1,price:0,tax:0}]),[h,D]=N.useState(!1),[T,E]=N.useState([]),[q,$]=N.useState(null),[F,R]=N.useState({}),M=N.useRef(null),[l,f]=N.useState(""),j=t=>{$(t),setTimeout(()=>{window.print(),$(null)},100)},w=N.useRef(!1),A=N.useRef(null),I=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,L=t=>(t||"").replace(/\D/g,"").length,U=N.useCallback(t=>({email:t.email&&!I.test(t.email)?"Invalid email":"",companyEmail:t.companyEmail&&!I.test(t.companyEmail)?"Invalid email":"",phone:t.phone&&L(t.phone)<7?"Invalid phone":"",companyPhone:t.companyPhone&&L(t.companyPhone)<7?"Invalid phone":""}),[]),ee=N.useMemo(()=>Object.values(F).every(t=>!t),[F]),X=N.useCallback(()=>{try{const t=new Date,s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),p=`${s}${n}${a}`,c=`poSeq:${p}`,b=Number(localStorage.getItem(c)||"0")+1;return localStorage.setItem(c,String(b)),`PO-${p}-${String(b).padStart(3,"0")}`}catch{const t=Math.floor(Math.random()*1e3);return`PO-${Date.now()}-${String(t).padStart(3,"0")}`}},[]);N.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem("poList")||"[]");Array.isArray(t)&&E(t)}catch{}},[]),N.useEffect(()=>{h&&(o||r(X()))},[h,o,X]);const xe=()=>v(t=>[...t,{product:"",description:"",note:"",qty:1,price:0,tax:0}]),W=(t,s,n)=>v(a=>a.map((p,c)=>c===t?{...p,[s]:s==="qty"||s==="price"||s==="tax"?Number(n):n}:p)),he=t=>v(s=>s.filter((n,a)=>a!==t)),te=N.useCallback(()=>{const t=(i.email||"").trim().toLowerCase();if(t)return t;const s=(i.companyEmail||"").trim().toLowerCase();if(s)return s;const n=(i.phone||"").trim();if(n)return n;const a=(i.name||"").trim().toLowerCase();return a||""},[i]);N.useEffect(()=>{if(!h)return;const t=te();if(t){if(!w.current)try{const s=JSON.parse(localStorage.getItem(`history:${t}`)||"{}");s.customer&&(d(n=>({name:n.name||s.customer.name||"",company:n.company||s.customer.company||"",email:n.email||s.customer.email||"",companyEmail:n.companyEmail||s.customer.companyEmail||"",phone:n.phone||s.customer.phone||"",companyPhone:n.companyPhone||s.customer.companyPhone||"",deliveryTo:n.deliveryTo||s.customer.deliveryTo||""})),w.current=!0)}catch{}return A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{try{const s=JSON.parse(localStorage.getItem(`history:${t}`)||"{}"),n={...s,customer:{...i},quotations:Array.isArray(s.quotations)?s.quotations:[],invoices:Array.isArray(s.invoices)?s.invoices:[],emails:Array.isArray(s.emails)?s.emails:[]};localStorage.setItem(`history:${t}`,JSON.stringify(n))}catch{}},500),()=>{A.current&&(clearTimeout(A.current),A.current=null)}}},[h,i.name,i.company,i.email,i.phone,te]);const G=N.useCallback(t=>{E(t);try{localStorage.setItem("poList",JSON.stringify(t))}catch{}},[]),pe=()=>{f(""),M.current&&M.current.click()},ye=t=>{try{const s={poNumber:t.poNumber,customer:t.customer,extraFields:t.extraFields,items:t.items,updatedAt:t.updatedAt},n=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),p=document.createElement("a");p.href=a,p.download=`PO_${t.poNumber||"unknown"}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(a)}catch{}},se=t=>{const s=Number((t==null?void 0:t.qty)||0),n=Number((t==null?void 0:t.price)||0),a=Number((t==null?void 0:t.tax)||0);return{product:String((t==null?void 0:t.product)||""),description:String((t==null?void 0:t.description)||""),note:String((t==null?void 0:t.note)||""),qty:Number.isFinite(s)?s:0,price:Number.isFinite(n)?n:0,tax:Number.isFinite(a)?a:0}},Y=t=>{var a,p,c,b,u,y,k,C,_,S,O;const s=String((t==null?void 0:t.poNumber)||"").trim(),n=new Date().toISOString();return{poNumber:s||X(),customer:{name:String(((a=t==null?void 0:t.customer)==null?void 0:a.name)||""),company:String(((p=t==null?void 0:t.customer)==null?void 0:p.company)||""),email:String(((c=t==null?void 0:t.customer)==null?void 0:c.email)||""),companyEmail:String(((b=t==null?void 0:t.customer)==null?void 0:b.companyEmail)||""),phone:String(((u=t==null?void 0:t.customer)==null?void 0:u.phone)||""),companyPhone:String(((y=t==null?void 0:t.customer)==null?void 0:y.companyPhone)||"")},extraFields:{refQuotation:String(((k=t==null?void 0:t.extraFields)==null?void 0:k.refQuotation)||""),orderDate:String(((C=t==null?void 0:t.extraFields)==null?void 0:C.orderDate)||""),deliveryDate:String(((_=t==null?void 0:t.extraFields)==null?void 0:_.deliveryDate)||""),paymentTerms:String(((S=t==null?void 0:t.extraFields)==null?void 0:S.paymentTerms)||""),deliveryTo:String(((O=t==null?void 0:t.extraFields)==null?void 0:O.deliveryTo)||"")},items:Array.isArray(t==null?void 0:t.items)?t.items.map(se):[],updatedAt:(t==null?void 0:t.updatedAt)||n}},ae=t=>String(t||"").trim().toLowerCase().replace(/[\s_]+/g,""),ge=t=>{const s=[];let n=0;const a=t.length,p=[];let c="",b=!1;for(;n<a;){const y=t[n];if(b)if(y==='"')if(t[n+1]==='"'){c+='"',n+=2;continue}else{b=!1,n++;continue}else{c+=y,n++;continue}else{if(y==='"'){b=!0,n++;continue}if(y===","){p.push(c),c="",n++;continue}if(y===`
`||y==="\r"){for((c.length||p.length)&&(p.push(c),s.push(p.slice()),p.length=0,c="");t[n+1]===`
`||t[n+1]==="\r";)n++;n++;continue}c+=y,n++}}if((c.length||p.length)&&(p.push(c),s.push(p.slice())),!s.length)return[];const u=s[0].map(ae);return s.slice(1).map(y=>{const k={};for(let C=0;C<u.length;C++)k[u[C]]=y[C]!=null?y[C]:"";return k})},be=t=>{const s=ge(t);if(!s.length)return[];const n=new Map,a=(c,b)=>{for(const u of b){const y=c[ae(u)];if(y!=null&&String(y).trim()!=="")return String(y).trim()}return""};return s.forEach(c=>{const b=a(c,["poNumber","po_number","ponumber","po no","purchaseorderno"]),u=b||"PO";n.has(u)||n.set(u,{poNumber:b,customer:{name:a(c,["contact","contactperson","contact_name"]),company:a(c,["vendor","vendorname","company"]),email:a(c,["email","vendoremail"]),companyEmail:a(c,["companyemail"]),phone:a(c,["phone","vendorphone"]),companyPhone:a(c,["companyphone"])},extraFields:{refQuotation:a(c,["refQuotation","quotation","quotationno"]),orderDate:a(c,["orderDate","dateOfOrder","orderdate"]),deliveryDate:a(c,["deliveryDate"]),paymentTerms:a(c,["paymentTerms","payment"]),deliveryTo:a(c,["deliveryTo","deliveryaddress"])},items:[],updatedAt:new Date().toISOString()});const y={product:a(c,["itemProduct","product","item_code"]),description:a(c,["itemDescription","description"]),note:a(c,["itemNote","note"]),qty:Number(a(c,["itemQty","qty","quantity"]))||0,price:Number(a(c,["itemPrice","price","unitprice"]))||0,tax:Number(a(c,["itemTax","tax"]))||0};Object.values(y).some(k=>(typeof k=="number"?k:String(k).trim())!=="")&&n.get(u).items.push(y)}),Array.from(n.values()).map(c=>Y(c))},Ne=async t=>{const s=await t.arrayBuffer(),p=await(await import("pdfjs-dist")).getDocument({data:s,disableWorker:!0}).promise;let c="";for(let b=1;b<=p.numPages;b++){const k=(await(await p.getPage(b)).getTextContent()).items.map(C=>C.str).join(" ");c+=`
`+k}return c},fe=t=>{const s=String(t||"").split(/\r?\n+/).map(P=>P.trim()).filter(Boolean),n=s.join(`
`),a=P=>{for(const H of P){const z=n.match(H);if(z&&z[1])return z[1].trim()}return""},p=a([/purchase\s*order\s*no\.?\s*[:\-]\s*(.+)/i,/po\s*number\s*[:\-]\s*(.+)/i,/po\s*no\.?\s*[:\-]\s*(.+)/i]),c=a([/vendor\s*[:\-]\s*(.+)/i,/company\s*[:\-]\s*(.+)/i]),b=a([/contact\s*(?:person)?\s*[:\-]\s*(.+)/i]),u=a([/email\s*[:\-]\s*([^\s]+)\b/i]),y=a([/phone\s*[:\-]\s*(.+)/i,/tel\s*[:\-]\s*(.+)/i]),k=a([/(?:delivery\s*to|ship\s*to)\s*[:\-]\s*(.+)/i]),C=a([/(?:ref\.?\s*quotation|quotation\s*no\.?)\s*[:\-]\s*(.+)/i]),_=a([/(?:order\s*date|date\s*of\s*order)\s*[:\-]\s*(.+)/i]),S=a([/delivery\s*date\s*[:\-]\s*(.+)/i]),O=a([/payment\s*terms?\s*[:\-]\s*(.+)/i]),Q=[],J=/(?:^|\s)(\d+(?:\.\d+)?)(?:\s|$)/;s.forEach(P=>{const H=/qty|quantity/i.test(P)||/\b\d+\b/.test(P),z=/price|unit\s*price/i.test(P)||/\b\d+\.\d{1,2}\b/.test(P);if(H&&z){const K=P.match(/\bqty\b[:\-]?\s*(\d+)/i)||P.match(J),ne=P.match(/\bunit\s*price\b[:\-]?\s*(\d+(?:\.\d+)?)/i)||P.match(/\b(\d+\.\d{1,2})\b(?!.*\b\d+\.\d{1,2}\b)/),oe=P.match(/\btax\b[:\-]?\s*(\d+(?:\.\d+)?)/i),Ae=K?Number(K[1]):0,Ce=ne?Number(ne[1]):0,Pe=oe?Number(oe[1]):0,le=P.split(/\s{2,}|,|\t/),Te=le[0]||"",qe=le.slice(1).join(" ").replace(/qty.*$/i,"").replace(/unit\s*price.*$/i,"").trim();Q.push(se({product:Te,description:qe,qty:Ae,price:Ce,tax:Pe}))}});const V={poNumber:p,customer:{name:b,company:c,email:u,phone:y},extraFields:{refQuotation:C,orderDate:_,deliveryDate:S,paymentTerms:O,deliveryTo:k},items:Q,updatedAt:new Date().toISOString()};return[Y(V)]},je=async t=>{const s=t.target.files&&t.target.files[0];if(s){try{const n=String(s.name||"").toLowerCase();let a=[];if(n.endsWith(".csv")){const u=await s.text();a=be(u)}else if(n.endsWith(".pdf")){const u=await Ne(s);if(!u||u.trim().length<20){f("PDF appears scanned or unrecognized; please use CSV or a text-based PDF"),t.target.value="";return}a=fe(u)}else{const u=await s.text(),y=JSON.parse(u);Array.isArray(y)?a=y.map(Y):y&&typeof y=="object"&&(a=[Y(y)])}const p=a;if(!Array.isArray(p)||!p.length){t.target.value="";return}const c=[...T];p.forEach(u=>{const y=c.findIndex(k=>String(k.poNumber||"")===String(u.poNumber||""));y>=0?c[y]=u:c.unshift(u)}),G(c);const b=p[0];r(u=>u||b.poNumber||""),d(u=>{var y,k,C,_,S,O;return{name:u.name||((y=b.customer)==null?void 0:y.name)||"",company:u.company||((k=b.customer)==null?void 0:k.company)||"",email:u.email||((C=b.customer)==null?void 0:C.email)||"",companyEmail:u.companyEmail||((_=b.customer)==null?void 0:_.companyEmail)||"",phone:u.phone||((S=b.customer)==null?void 0:S.phone)||"",companyPhone:u.companyPhone||((O=b.customer)==null?void 0:O.companyPhone)||""}}),g(u=>{var y,k,C,_,S;return{refQuotation:u.refQuotation||((y=b.extraFields)==null?void 0:y.refQuotation)||"",orderDate:u.orderDate||((k=b.extraFields)==null?void 0:k.orderDate)||new Date().toISOString().slice(0,10),deliveryDate:u.deliveryDate||((C=b.extraFields)==null?void 0:C.deliveryDate)||"",paymentTerms:u.paymentTerms||((_=b.extraFields)==null?void 0:_.paymentTerms)||"",deliveryTo:u.deliveryTo||((S=b.extraFields)==null?void 0:S.deliveryTo)||""}}),v(u=>{const y=Array.isArray(b.items)&&b.items.length?b.items:[{product:"",description:"",note:"",qty:1,price:0,tax:0}];if(!Array.isArray(u)||u.length===0)return y;const k=S=>{const O=String(S.product||"").trim()==="",Q=String(S.description||"").trim()==="",J=String(S.note||"").trim()==="",V=!Number(S.qty)||Number(S.qty)<=1,P=!Number(S.price)||Number(S.price)<=0,H=!Number(S.tax)||Number(S.tax)<=0;return O&&Q&&J&&V&&P&&H};if(u.length===1&&k(u[0]))return y;const C=Math.max(u.length,y.length),_=[];for(let S=0;S<C;S++){const O=u[S]||{},Q=y[S]||{},J=Number(O.qty),V=Number(O.price),P=Number(O.tax),H=Number(Q.qty),z=Number(Q.price),K=Number(Q.tax);_[S]={product:O.product||Q.product||"",description:O.description||Q.description||"",note:O.note||Q.note||"",qty:Number.isFinite(J)&&J>0?J:Number.isFinite(H)?H:0,price:Number.isFinite(V)&&V>0?V:Number.isFinite(z)?z:0,tax:Number.isFinite(P)&&P>0?P:Number.isFinite(K)?K:0}}return _}),D(!0)}catch{}t.target.value=""}},ve=()=>{r(""),d({name:"",company:"",email:"",companyEmail:"",phone:"",companyPhone:""}),g({refQuotation:"",orderDate:new Date().toISOString().slice(0,10),deliveryDate:"",paymentTerms:"",deliveryTo:""}),v([{product:"",description:"",note:"",qty:1,price:0,tax:0}]),w.current=!1,D(!0)},we=t=>{const s=T[t];s&&(r(s.poNumber||""),d(s.customer||{name:"",company:"",email:"",companyEmail:"",phone:"",companyPhone:""}),g(s.extraFields||{refQuotation:"",orderDate:"",deliveryDate:"",paymentTerms:"",deliveryTo:""}),v(Array.isArray(s.items)&&s.items.length?s.items:[{product:"",description:"",note:"",qty:1,price:0,tax:0}]),D(!0))},Se=t=>{const s=T.filter((n,a)=>a!==t);G(s)},re=async t=>{try{const s=localStorage.getItem("authToken");if(!s)return;const n=(t.items||[]).reduce((b,u)=>b+(Number(u.qty)||0)*(Number(u.price)||0),0),a=n*.07,p=n+a,c={number:t.poNumber,customer:t.customer,extra_fields:t.extraFields,items:t.items,totals:{subtotal:n,taxTotal:a,total:p}};await fetch(`${Z}/api/purchase_orders/`,{method:"POST",headers:{Authorization:`Token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(c)})}catch{}},ke=async()=>{const t=U(i);if(R(t),Object.values(t).some(p=>!!p))return;const s={poNumber:o,customer:i,extraFields:x,items:m,updatedAt:new Date().toISOString()},n=T.findIndex(p=>p.poNumber===o);let a=[];n>=0?(a=T.slice(),a[n]=s):a=[s,...T],G(a),await re(s),j(s),D(!1)},De=async()=>{const t=U(i);if(R(t),Object.values(t).some(a=>!!a))return;const s={poNumber:o,customer:i,extraFields:x,items:m,updatedAt:new Date().toISOString()},n=T.findIndex(a=>a.poNumber===o);if(n>=0){const a=T.slice();a[n]=s,G(a)}else G([s,...T]);await re(s),D(!1)};return e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#2D4485] mb-2",children:"Purchase Order"}),!h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:ve,className:"btn-primary",children:"Add Purchase Order"})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"p-2",children:"PO Number"}),e.jsx("th",{className:"p-2",children:"Customer"}),e.jsx("th",{className:"p-2",children:"Items"}),e.jsx("th",{className:"p-2",children:"Updated"}),e.jsx("th",{className:"p-2",children:"Save File"}),e.jsx("th",{className:"p-2"})]})}),e.jsxs("tbody",{children:[T.map((t,s)=>{var n,a,p,c;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:t.poNumber}),e.jsx("td",{className:"p-2",children:((n=t.customer)==null?void 0:n.name)||((a=t.customer)==null?void 0:a.company)||((p=t.customer)==null?void 0:p.email)||((c=t.customer)==null?void 0:c.phone)||"-"}),e.jsx("td",{className:"p-2",children:Array.isArray(t.items)?t.items.length:0}),e.jsx("td",{className:"p-2",children:t.updatedAt?new Date(t.updatedAt).toLocaleString():"-"}),e.jsx("td",{className:"p-2",children:e.jsx("button",{onClick:()=>ye(t),className:"btn-outline",children:"Save File"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>we(s),className:"btn-outline",children:"Edit"}),e.jsx("button",{onClick:()=>j(t),className:"btn-outline",children:"Export PDF"}),e.jsx("button",{onClick:()=>Se(s),className:"btn-outline text-red-600",children:"Delete"})]})})]},s)}),T.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-2 text-gray-600",colSpan:5,children:"No purchase orders yet"})})]})]})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:pe,className:"btn-outline",children:"Import"}),e.jsx("input",{ref:M,type:"file",accept:".json,.csv,application/json,application/pdf",onChange:je,className:"hidden"}),l&&e.jsx("div",{className:"text-xs text-red-600",children:l})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-700 border-b pb-1",children:"Vendor Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Vendor Name"}),e.jsx("input",{value:i.company,onChange:t=>d({...i,company:t.target.value}),placeholder:"Vendor Company Name",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Contact Person"}),e.jsx("input",{value:i.name,onChange:t=>d({...i,name:t.target.value}),placeholder:"Contact Person Name",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("input",{value:i.email,onChange:t=>{const s={...i,email:t.target.value};d(s),R(U(s))},placeholder:"Vendor Email",className:`w-full rounded-md border px-3 py-2 text-sm ${F.email?"border-red-500":"border-gray-300"}`}),F.email&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:F.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Phone"}),e.jsx("input",{value:i.phone,onChange:t=>{const s={...i,phone:t.target.value};d(s),R(U(s))},placeholder:"Vendor Phone",className:`w-full rounded-md border px-3 py-2 text-sm ${F.phone?"border-red-500":"border-gray-300"}`}),F.phone&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:F.phone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Delivery To"}),e.jsx("textarea",{value:x.deliveryTo,onChange:t=>g({...x,deliveryTo:t.target.value}),placeholder:"Delivery Address",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm h-20"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-700 border-b pb-1",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Ref. Quotation No."}),e.jsx("input",{value:x.refQuotation,onChange:t=>g({...x,refQuotation:t.target.value}),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Purchase Order No."}),e.jsx("input",{value:o,onChange:t=>r(t.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm font-semibold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Date of Order"}),e.jsx("input",{type:"date",value:x.orderDate,onChange:t=>g({...x,orderDate:t.target.value}),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Delivery Date"}),e.jsx("input",{type:"date",value:x.deliveryDate,onChange:t=>g({...x,deliveryDate:t.target.value}),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Payment Terms"}),e.jsx("input",{value:x.paymentTerms,onChange:t=>g({...x,paymentTerms:t.target.value}),placeholder:"e.g. 30 Days",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]})]})]}),e.jsx("div",{className:"overflow-x-auto mb-3 border rounded-lg",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"text-left text-gray-700 border-b",children:[e.jsx("th",{className:"p-3 w-16 text-center",children:"Item"}),e.jsx("th",{className:"p-3",children:"Product"}),e.jsx("th",{className:"p-3",children:"Description"}),e.jsx("th",{className:"p-3 w-24 text-right",children:"Q'ty"}),e.jsx("th",{className:"p-3 w-32 text-right",children:"Unit Price"}),e.jsx("th",{className:"p-3 w-32 text-right",children:"Total Amount"}),e.jsx("th",{className:"p-3 w-32",children:"Note"}),e.jsx("th",{className:"p-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y",children:m.map((t,s)=>{const n=(Number(t.qty)||0)*(Number(t.price)||0);return e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"p-2 text-center text-gray-500",children:s+1}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:t.product,onChange:a=>W(s,"product",a.target.value),placeholder:"Product Code/Name",className:"w-full border-none focus:ring-0 bg-transparent p-0 text-sm"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:t.description,onChange:a=>W(s,"description",a.target.value),placeholder:"Description",className:"w-full border-none focus:ring-0 bg-transparent p-0 text-sm"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",min:"0",value:t.qty,onChange:a=>W(s,"qty",a.target.value),className:"w-full text-right border rounded px-1 py-1"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.price,onChange:a=>W(s,"price",a.target.value),className:"w-full text-right border rounded px-1 py-1"})}),e.jsx("td",{className:"p-2 text-right font-medium text-gray-700",children:n.toFixed(2)}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:t.note||"",onChange:a=>W(s,"note",a.target.value),placeholder:"Note",className:"w-full border rounded px-2 py-1 text-sm"})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{onClick:()=>he(s),className:"text-red-500 hover:text-red-700",title:"Remove",children:"×"})})]},s)})}),e.jsx("tfoot",{className:"bg-gray-50 border-t",children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-2 text-center",children:e.jsx("button",{onClick:xe,className:"text-blue-600 hover:underline text-sm",children:"+ Add Item"})})})})]})}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs("div",{className:"w-64 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sub Total"}),e.jsx("span",{className:"font-medium",children:m.reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vat 7%"}),e.jsx("span",{className:"font-medium",children:(m.reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0)*.07).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 text-base",children:[e.jsx("span",{className:"font-bold text-[#2D4485]",children:"Grand Total Amount"}),e.jsx("span",{className:"font-bold text-[#2D4485]",children:(m.reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0)*1.07).toFixed(2)})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{onClick:De,disabled:!ee,className:"btn-outline disabled:opacity-50",children:"Save"}),e.jsx("button",{onClick:ke,disabled:!ee,className:"btn-primary disabled:opacity-50",children:"Generate PO"}),e.jsx("button",{onClick:()=>D(!1),className:"btn-outline",children:"Cancel"})]})]}),e.jsx("div",{style:{position:"absolute",left:"-9999px",top:0,width:"210mm"}}),q&&Fe.createPortal(e.jsxs("div",{className:"print-portal",children:[e.jsx("style",{children:`
                @media print {
                    body > *:not(.print-portal) { display: none !important; }
                    .print-portal { 
                        display: block !important; 
                        position: absolute; 
                        top: 0; 
                        left: 0; 
                        width: 100%; 
                        background: white; 
                        z-index: 9999;
                    }
                    @page { margin: 0; size: auto; }
                }
                /* Hide on screen */
                .print-portal { display: none; }
                @media print { .print-portal { display: block; } }
            `}),e.jsx(Le,{q:{customer:q.customer||{},items:q.items||[],extraFields:q.extraFields||{},details:{number:q.poNumber,currency:"THB"},subtotal:(q.items||[]).reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0),taxTotal:(q.items||[]).reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0)*.07,total:(q.items||[]).reduce((t,s)=>t+(Number(s.qty)||0)*(Number(s.price)||0),0)*1.07}})]}),document.body)]})}const Qe=()=>{const o={quotations:[],invoices:[],customers:[],purchaseOrders:[]};try{try{const r=JSON.parse(localStorage.getItem("poList")||"[]");Array.isArray(r)&&(o.purchaseOrders=r)}catch(r){console.error("Error parsing poList",r)}for(let r=0;r<localStorage.length;r++){const i=localStorage.key(r);if(i&&i.startsWith("history:"))try{const d=JSON.parse(localStorage.getItem(i));d&&(d.customer&&o.customers.push(d.customer),Array.isArray(d.quotations)&&d.quotations.forEach(x=>{var g,m;o.quotations.push({...x,customerName:((g=d.customer)==null?void 0:g.name)||((m=d.customer)==null?void 0:m.company)})}),Array.isArray(d.invoices)&&d.invoices.forEach(x=>{var g,m;o.invoices.push({...x,customerName:((g=d.customer)==null?void 0:g.name)||((m=d.customer)==null?void 0:m.company)})}))}catch(d){console.error("Error parsing key",i,d)}}}catch(r){console.error("Error accessing localStorage",r)}return o.quotations.sort((r,i)=>{var d,x;return new Date(i.savedAt||((d=i.details)==null?void 0:d.date))-new Date(r.savedAt||((x=r.details)==null?void 0:x.date))}),o.invoices.sort((r,i)=>{var d,x;return new Date(i.savedAt||((d=i.details)==null?void 0:d.date))-new Date(r.savedAt||((x=r.details)==null?void 0:x.date))}),o.purchaseOrders.sort((r,i)=>{var d,x;return new Date(i.updatedAt||((d=i.extraFields)==null?void 0:d.orderDate))-new Date(r.updatedAt||((x=r.extraFields)==null?void 0:x.orderDate))}),o};function Ue({data:o}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium",children:"Total Quotations"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(ce,{className:"w-5 h-5 text-blue-600"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.quotations.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium",children:"Total Invoices"}),e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-green-600"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.invoices.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium",children:"Purchase Orders"}),e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(ue,{className:"w-5 h-5 text-orange-600"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.purchaseOrders.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-gray-500 text-sm font-medium",children:"Customers"}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.customers.length})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Quotations"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"pb-2",children:"Number"}),e.jsx("th",{className:"pb-2",children:"Customer"}),e.jsx("th",{className:"pb-2",children:"Date"}),e.jsx("th",{className:"pb-2 text-right",children:"Amount"})]})}),e.jsxs("tbody",{className:"divide-y",children:[o.quotations.slice(0,5).map((r,i)=>{var d,x,g,m,v;return e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium text-blue-600",children:(d=r.details)==null?void 0:d.number}),e.jsx("td",{className:"py-3",children:r.customerName||"-"}),e.jsx("td",{className:"py-3",children:(x=r.details)==null?void 0:x.date}),e.jsxs("td",{className:"py-3 text-right",children:[(g=r.details)==null?void 0:g.currency," ",(v=(m=r.totals)==null?void 0:m.total)==null?void 0:v.toFixed(2)]})]},i)}),o.quotations.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-4 text-center text-gray-500",children:"No quotations found"})})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Invoices"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"pb-2",children:"Number"}),e.jsx("th",{className:"pb-2",children:"Customer"}),e.jsx("th",{className:"pb-2",children:"Due Date"}),e.jsx("th",{className:"pb-2 text-right",children:"Amount"})]})}),e.jsxs("tbody",{className:"divide-y",children:[o.invoices.slice(0,5).map((r,i)=>{var d,x,g,m,v;return e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium text-green-600",children:(d=r.details)==null?void 0:d.number}),e.jsx("td",{className:"py-3",children:r.customerName||"-"}),e.jsx("td",{className:"py-3",children:(x=r.details)==null?void 0:x.dueDate}),e.jsxs("td",{className:"py-3 text-right",children:[(g=r.details)==null?void 0:g.currency," ",(v=(m=r.totals)==null?void 0:m.total)==null?void 0:v.toFixed(2)]})]},i)}),o.invoices.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-4 text-center text-gray-500",children:"No invoices found"})})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Purchase Orders"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"pb-2",children:"PO Number"}),e.jsx("th",{className:"pb-2",children:"Vendor"}),e.jsx("th",{className:"pb-2",children:"Items"}),e.jsx("th",{className:"pb-2 text-right",children:"Total Amount"})]})}),e.jsxs("tbody",{className:"divide-y",children:[o.purchaseOrders.slice(0,5).map((r,i)=>{var x,g,m;const d=(r.items||[]).reduce((v,h)=>v+(Number(h.qty)||0)*(Number(h.price)||0),0)*1.07;return e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium text-orange-600",children:r.poNumber}),e.jsx("td",{className:"py-3",children:((x=r.customer)==null?void 0:x.company)||((g=r.customer)==null?void 0:g.name)||"-"}),e.jsx("td",{className:"py-3",children:((m=r.items)==null?void 0:m.length)||0}),e.jsxs("td",{className:"py-3 text-right",children:["THB ",d.toFixed(2)]})]},i)}),o.purchaseOrders.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-4 text-center text-gray-500",children:"No purchase orders found"})})]})]})})]})]})]})}function He({list:o}){return e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Quotations"}),e.jsxs("a",{href:"/quotation.html",className:"flex items-center gap-2 px-4 py-2 bg-[#2D4485] text-white rounded-lg hover:bg-[#1e2f5c] transition-colors text-sm font-medium",children:[e.jsx(de,{className:"w-4 h-4"}),"New Quotation"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700 border-b",children:[e.jsx("th",{className:"p-3 text-left",children:"Number"}),e.jsx("th",{className:"p-3 text-left",children:"Customer"}),e.jsx("th",{className:"p-3 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-left",children:"Items"}),e.jsx("th",{className:"p-3 text-right",children:"Total"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[o.map((r,i)=>{var d,x,g,m,v,h;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium text-[#2D4485]",children:(d=r.details)==null?void 0:d.number}),e.jsx("td",{className:"p-3",children:r.customerName||"-"}),e.jsx("td",{className:"p-3",children:(x=r.details)==null?void 0:x.date}),e.jsx("td",{className:"p-3",children:((g=r.items)==null?void 0:g.length)||0}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[(m=r.details)==null?void 0:m.currency," ",(h=(v=r.totals)==null?void 0:v.total)==null?void 0:h.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-xs text-gray-400",children:"View in History"})})]},i)}),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"No quotations found"})})]})]})})]})}function ze({list:o}){return e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Invoices"}),e.jsxs("a",{href:"/invoice.html",className:"flex items-center gap-2 px-4 py-2 bg-[#2D4485] text-white rounded-lg hover:bg-[#1e2f5c] transition-colors text-sm font-medium",children:[e.jsx(de,{className:"w-4 h-4"}),"New Invoice"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700 border-b",children:[e.jsx("th",{className:"p-3 text-left",children:"Number"}),e.jsx("th",{className:"p-3 text-left",children:"Customer"}),e.jsx("th",{className:"p-3 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-left",children:"Due Date"}),e.jsx("th",{className:"p-3 text-right",children:"Total"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[o.map((r,i)=>{var d,x,g,m,v,h;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium text-green-600",children:(d=r.details)==null?void 0:d.number}),e.jsx("td",{className:"p-3",children:r.customerName||"-"}),e.jsx("td",{className:"p-3",children:(x=r.details)==null?void 0:x.date}),e.jsx("td",{className:"p-3",children:(g=r.details)==null?void 0:g.dueDate}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[(m=r.details)==null?void 0:m.currency," ",(h=(v=r.totals)==null?void 0:v.total)==null?void 0:h.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-xs text-gray-400",children:"View in History"})})]},i)}),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"No invoices found"})})]})]})})]})}function Je({data:o}){const[r,i]=N.useState(""),[d,x]=N.useState([]);N.useEffect(()=>{const m=[];try{for(let v=0;v<localStorage.length;v++){const h=localStorage.key(v);if(h&&h.startsWith("history:")){const D=JSON.parse(localStorage.getItem(h));m.push({key:h,...D})}}}catch{}x(m)},[]);const g=d.filter(m=>{var E,q,$,F,R,M;const v=r.toLowerCase(),h=((q=(E=m.customer)==null?void 0:E.name)==null?void 0:q.toLowerCase())||"",D=((F=($=m.customer)==null?void 0:$.company)==null?void 0:F.toLowerCase())||"",T=((M=(R=m.customer)==null?void 0:R.email)==null?void 0:M.toLowerCase())||"";return h.includes(v)||D.includes(v)||T.includes(v)});return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{value:r,onChange:m=>i(m.target.value),placeholder:"Search customers...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"})]})}),e.jsxs("div",{className:"space-y-8",children:[g.map((m,v)=>{var h,D,T,E,q,$,F,R,M;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-[#2D4485]",children:((h=m.customer)==null?void 0:h.company)||((D=m.customer)==null?void 0:D.name)||"Unknown Customer"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(T=m.customer)==null?void 0:T.name," • ",(E=m.customer)==null?void 0:E.email," • ",(q=m.customer)==null?void 0:q.phone]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:["Quotations (",(($=m.quotations)==null?void 0:$.length)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[(m.quotations||[]).slice(0,3).map((l,f)=>{var j,w,A,I;return e.jsxs("div",{className:"text-sm flex justify-between bg-gray-50 p-2 rounded",children:[e.jsx("span",{children:(j=l.details)==null?void 0:j.number}),e.jsxs("span",{className:"font-medium",children:[(w=l.details)==null?void 0:w.currency," ",(I=(A=l.totals)==null?void 0:A.total)==null?void 0:I.toFixed(2)]})]},f)}),(((F=m.quotations)==null?void 0:F.length)||0)>3&&e.jsxs("div",{className:"text-xs text-gray-400 italic",children:["...and ",m.quotations.length-3," more"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:["Invoices (",((R=m.invoices)==null?void 0:R.length)||0,")"]}),e.jsxs("div",{className:"space-y-2",children:[(m.invoices||[]).slice(0,3).map((l,f)=>{var j,w,A,I;return e.jsxs("div",{className:"text-sm flex justify-between bg-gray-50 p-2 rounded",children:[e.jsx("span",{children:(j=l.details)==null?void 0:j.number}),e.jsxs("span",{className:"font-medium text-green-600",children:[(w=l.details)==null?void 0:w.currency," ",(I=(A=l.totals)==null?void 0:A.total)==null?void 0:I.toFixed(2)]})]},f)}),(((M=m.invoices)==null?void 0:M.length)||0)>3&&e.jsxs("div",{className:"text-xs text-gray-400 italic",children:["...and ",m.invoices.length-3," more"]})]})]})]})]},v)}),g.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No customer history found"})]})]})})}function Ve(){const[o,r]=N.useState([]),[i,d]=N.useState(!1),[x,g]=N.useState(null),m=["Manufacturing","Inventory","CRM","Project Management","Admin"],v=l=>l?l==="all"?[...m]:l.split(",").map(f=>f.trim()).filter(Boolean):[],[h,D]=N.useState(null),T=N.useCallback(async()=>{try{const l=localStorage.getItem("authToken"),f=localStorage.getItem("currentUser");let j=null;try{j=JSON.parse(f||"{}")}catch{}if(!j||!j.email&&!j.name){D(null);return}let w=localStorage.getItem("allowedApps");if(l)try{const I=await fetch(`${Z}/api/auth/me/allowed-apps/`,{headers:{Authorization:`Token ${l}`}});if(I.ok){const L=await I.json();typeof L.allowed_apps=="string"&&(w=L.allowed_apps,localStorage.setItem("allowedApps",L.allowed_apps))}}catch{}const A=localStorage.getItem("userRole");D({id:null,email:j.email||"",name:j.name||"",is_staff:A==="Admin",allowed_apps:w||""})}catch{D(null)}},[]),E=N.useCallback(async()=>{try{d(!0);const l=localStorage.getItem("authToken");if(!l){r([]),d(!1);return}const f=await fetch(`${Z}/api/users/`,{headers:{Authorization:`Token ${l}`}});if(f.ok){const j=await f.json();r(Array.isArray(j)?j:[])}else r([])}catch{r([])}finally{d(!1)}},[]);N.useEffect(()=>{T(),E()},[E,T]),N.useEffect(()=>{if(h&&!h.id&&o.length){const l=o.find(f=>h.email&&f.email===h.email);l&&D({...h,id:l.id,allowed_apps:l.allowed_apps??h.allowed_apps,is_staff:l.is_staff})}},[o,h]);const q=(l,f)=>v(l).includes(f),$=async(l,f)=>{try{g(l);const j=localStorage.getItem("authToken");if(!j)return;console.log(`Saving permissions for user ${l}: ${f}`);const w=await fetch(`${Z}/api/users/permissions/`,{method:"POST",headers:{Authorization:`Token ${j}`,"Content-Type":"application/json"},body:JSON.stringify({user_id:l,allowed_apps:f})});w.ok?console.log("Permissions saved successfully"):(console.error("Failed to save permissions",w.status,await w.text()),alert("Failed to save permissions. Please try again."),await E())}catch(j){console.error("Error saving permissions",j),alert("Error saving permissions: "+j.message),await E()}finally{g(null)}},F=(l,f)=>{const j=o.find(L=>L.id===l);if(!j)return;const w=v(j.allowed_apps||"");let A=[];w.includes(f)?A=w.filter(L=>L!==f):A=[...w,f];const I=A.length===m.length?"all":A.length?A.join(","):"";r(L=>L.map(U=>U.id===l?{...U,allowed_apps:I}:U)),h&&h.id===l&&D(L=>({...L,allowed_apps:I})),$(l,I)},R=l=>{const f="all";r(j=>j.map(w=>w.id===l?{...w,allowed_apps:f}:w)),h&&h.id===l&&D(j=>({...j,allowed_apps:f})),$(l,f)},M=l=>{const f="";r(j=>j.map(w=>w.id===l?{...w,allowed_apps:f}:w)),h&&h.id===l&&D(j=>({...j,allowed_apps:f})),$(l,f)};return e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"User Permissions"}),e.jsx("button",{onClick:E,className:"px-3 py-2 text-sm rounded-lg border border-gray-300 bg-gray-100 hover:bg-gray-200",children:"Refresh"})]}),i?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"Loading users..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700 border-b",children:[e.jsx("th",{className:"p-3 text-left",children:"User"}),e.jsx("th",{className:"p-3 text-left",children:"Role"}),e.jsx("th",{className:"p-3 text-left",children:"Allowed Apps"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[[...h?[h]:[],...o.filter(l=>!h||l.email!==h.email)].map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:h&&l.email===h.email?"You":l.name}),e.jsx("div",{className:"text-xs text-gray-500",children:l.email})]}),e.jsx("td",{className:"p-3",children:l.is_staff?"Admin":"User"}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:m.map(f=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:q(l.allowed_apps,f),onChange:()=>F(l.id,f)}),e.jsx("span",{children:f})]},f))})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>R(l.id),className:"px-2 py-1 text-xs rounded border border-gray-300",children:"All"}),e.jsx("button",{onClick:()=>M(l.id),className:"px-2 py-1 text-xs rounded border border-gray-300",children:"None"}),e.jsx("button",{onClick:()=>$(l.id,l.allowed_apps),className:`px-3 py-1.5 text-xs rounded bg-[#2D4485] text-white ${x===l.id?"opacity-50":""}`,disabled:!l.id||x===l.id,children:"Save"}),x===l.id&&e.jsx("span",{className:"text-xs text-gray-500",children:"Saving..."})]})})]},l.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-8 text-center text-gray-500",children:"No users available"})})]})]})})]})}function Be(){const[o,r]=N.useState("dashboard"),[i,d]=N.useState({quotations:[],invoices:[],customers:[],purchaseOrders:[]});return N.useEffect(()=>{d(Qe())},[o]),N.useEffect(()=>{const g=new URLSearchParams(window.location.search).get("view");g==="customerHistory"&&r("customers"),g==="purchaseOrders"&&r("purchase-orders")},[]),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsxs("aside",{className:"w-64 bg-white border-r hidden lg:block fixed top-16 bottom-0 overflow-y-auto pt-4",children:[e.jsx("div",{className:"px-6 mb-8",children:e.jsx("h2",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Admin Panel"})}),e.jsxs("nav",{className:"space-y-1 px-3",children:[e.jsxs("button",{onClick:()=>r("dashboard"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="dashboard"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(_e,{className:"w-5 h-5"}),"Dashboard"]}),e.jsxs("button",{onClick:()=>r("quotations"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="quotations"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(ce,{className:"w-5 h-5"}),"Quotations"]}),e.jsxs("button",{onClick:()=>r("invoices"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="invoices"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(me,{className:"w-5 h-5"}),"Invoices"]}),e.jsxs("button",{onClick:()=>r("purchase-orders"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="purchase-orders"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(ue,{className:"w-5 h-5"}),"Purchase Orders"]}),e.jsxs("button",{onClick:()=>r("customers"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="customers"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(ie,{className:"w-5 h-5"}),"Customer History"]}),e.jsxs("button",{onClick:()=>r("permissions"),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="permissions"?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(Ie,{className:"w-5 h-5"}),"User Permissions"]})]})]}),e.jsxs("main",{className:"flex-1 lg:ml-64 p-8",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[o==="dashboard"&&"Dashboard",o==="quotations"&&"Quotations",o==="invoices"&&"Invoices",o==="purchase-orders"&&"Purchase Orders",o==="customers"&&"Customer History",o==="permissions"&&"User Permissions"]})}),o==="dashboard"&&e.jsx(Ue,{data:i}),o==="quotations"&&e.jsx(He,{list:i.quotations}),o==="invoices"&&e.jsx(ze,{list:i.invoices}),o==="purchase-orders"&&e.jsx(Me,{}),o==="customers"&&e.jsx(Je,{data:i}),o==="permissions"&&e.jsx(Ve,{})]})]})}function We(){const[o,r]=N.useState(!1);return N.useEffect(()=>{try{const i=localStorage.getItem("userRole");localStorage.getItem("isAuthenticated")==="true"&&i==="Admin"?r(!0):window.location.href="/login.html"}catch{window.location.href="/login.html"}},[]),o?e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(Ee,{}),e.jsx(Be,{})]}):null}Oe.createRoot(document.getElementById("root")).render(e.jsx(N.StrictMode,{children:e.jsx($e,{children:e.jsx(We,{})})}));
