import{R as de,j as e,a as l}from"./index-BY_FY2h5.js";import{N as ue}from"./navigation-BPz6xB7x.js";function me(){const[t,h]=l.useState(""),[g,u]=l.useState("updatedAt"),[i,p]=l.useState("desc"),[a,m]=l.useState([]),[b,d]=l.useState(!1),[v,s]=l.useState(null),[j,k]=l.useState(null),[I,f]=l.useState(null),[B,T]=l.useState(!1),[G,R]=l.useState(null),[z,O]=l.useState(null),[V,U]=l.useState("Inventory Admin"),[P,J]=l.useState(""),[H,K]=l.useState("All"),[_,X]=l.useState(null),[Y,Z]=l.useState("inventory"),[q,ee]=l.useState(null),[L,we]=l.useState(1),$=20,C=r=>{m(r);try{localStorage.setItem("inventoryProducts",JSON.stringify(r))}catch{}},te=r=>{const o=/^WH\/IV\/(\d+)$/.exec(String(r||""));return o?parseInt(o[1],10):null},E=(r=a)=>{let o=0;for(const x of r){const c=te(x.sku);Number.isFinite(c)&&c>o&&(o=c)}return o+1};l.useEffect(()=>{try{const r=JSON.parse(localStorage.getItem("inventoryProducts")||"[]");if(Array.isArray(r)&&r.length){const o=r.map(n=>({sku:String(n.sku||""),name:n.name,stockQty:Number(n.stockQty||0),price:Number(n.price||0),updatedAt:n.updatedAt||new Date().toISOString().slice(0,10),photo:n.photo||"/eit-icon.png",instock:Number(n.instock||0),warehouse:n.warehouse||"Main",bin:n.bin||"A-01-01",lot:n.lot||"",expiry:n.expiry||"",reserved:Number(n.reserved||0),incomingQty:Number(n.incomingQty||0),outgoingQty:Number(n.outgoingQty||0),barcode:n.barcode||"",category:n.category||"Finished Goods",uom:n.uom||"pcs",description:n.description||"",brand:n.brand||"",model:n.model||"",status:n.status||"Active",minStock:Number(n.minStock||0),reorderQty:Number(n.reorderQty||0),valuationMethod:n.valuationMethod||"FIFO",serials:Array.isArray(n.serials)?n.serials:[],manufactureDate:n.manufactureDate||""}));let x=E(o);const c=o.map(n=>/^WH\/IV\/\d+$/.test(String(n.sku||""))?n:{...n,sku:`WH/IV/${x++}`});m(c);try{localStorage.setItem("inventoryProducts",JSON.stringify(c))}catch{}}else m([{sku:"WH/IV/1",name:"Simatic S7-1500",stockQty:15e3,price:12e4,updatedAt:"2021-02-20",photo:"/eit-icon.png",instock:1,warehouse:"Main",bin:"A-01-01",lot:"L210201",expiry:"2023-12-31",reserved:0,incomingQty:0,outgoingQty:0,barcode:"1234567890123",category:"Finished Goods",uom:"pcs",description:"",brand:"Siemens",model:"S7-1500",status:"Active",minStock:1e3,reorderQty:500,valuationMethod:"FIFO",serials:[],manufactureDate:""},{sku:"WH/IV/2",name:"Simatic S7-1500",stockQty:15e3,price:94e4,updatedAt:"2021-02-20",photo:"/eit-icon.png",instock:1,warehouse:"Main",bin:"A-01-02",lot:"L210202",expiry:"2024-03-31",reserved:500,incomingQty:100,outgoingQty:0,barcode:"1234567890123",category:"Finished Goods",uom:"pcs",description:"",brand:"Siemens",model:"S7-1500",status:"Active",minStock:1e3,reorderQty:500,valuationMethod:"FIFO",serials:[],manufactureDate:""},{sku:"WH/IV/3",name:"Simatic S7-1500",stockQty:15e3,price:29e4,updatedAt:"2021-02-20",photo:"/eit-icon.png",instock:-1,warehouse:"Secondary",bin:"B-02-01",lot:"L210203",expiry:"",reserved:0,incomingQty:0,outgoingQty:50,barcode:"1234567890123",category:"Finished Goods",uom:"pcs",description:"",brand:"Siemens",model:"S7-1500",status:"Active",minStock:1e3,reorderQty:500,valuationMethod:"FIFO",serials:[],manufactureDate:""},{sku:"WH/IV/4",name:"Simatic S7-1500",stockQty:15e3,price:42e4,updatedAt:"2021-02-20",photo:"/eit-icon.png",instock:1,warehouse:"Main",bin:"A-02-01",lot:"L210204",expiry:"2025-01-15",reserved:0,incomingQty:0,outgoingQty:0,barcode:"1234567890123",category:"Finished Goods",uom:"pcs",description:"",brand:"Siemens",model:"S7-1500",status:"Active",minStock:1e3,reorderQty:500,valuationMethod:"FIFO",serials:[],manufactureDate:""}])}catch{m([])}},[]);const se=l.useMemo(()=>{const r=new Set(a.map(o=>o.warehouse||"Main"));return["All",...Array.from(r)]},[a]),re=l.useMemo(()=>{const r=new Set(a.map(o=>o.category||"Finished Goods"));return["All",...Array.from(r)]},[a]),ne=[...a.filter(r=>(r.name||"").toLowerCase().includes(t.toLowerCase())).filter(r=>P?(r.sku||"").toLowerCase().includes(P.toLowerCase()):!0).filter(r=>H==="All"?!0:(r.category||"Finished Goods")===H)].sort((r,o)=>{const x=r[g],c=o[g];return typeof x=="number"&&typeof c=="number"?i==="asc"?x-c:c-x:i==="asc"?String(x).localeCompare(String(c)):String(c).localeCompare(String(x))}).slice((L-1)*$,L*$),oe=r=>{g===r?p(o=>o==="asc"?"desc":"asc"):(u(r),p("asc"))},ae=(r,o=!1)=>{const x=String(r.sku||""),n=/^WH\/IV\/\d+$/.test(x)?x:`WH/IV/${E()}`,N=[{...r,sku:n,stockQty:Number(r.stockQty||0),price:Number(r.price||0),reserved:Number(r.reserved||0),incomingQty:Number(r.incomingQty||0),outgoingQty:Number(r.outgoingQty||0),minStock:Number(r.minStock||0),reorderQty:Number(r.reorderQty||0),updatedAt:r.updatedAt||new Date().toISOString().slice(0,10),instock:r.instock||1,photo:r.photo||"/eit-icon.png"},...a];C(N),o||d(!1)},D=r=>{try{const o=JSON.parse(localStorage.getItem("inventoryMovements")||"[]");o.push({...r,ts:new Date().toISOString(),user:V}),localStorage.setItem("inventoryMovements",JSON.stringify(o))}catch{}};return{query:t,setQuery:h,pageItems:ne,toggleSort:oe,sortKey:g,sortDir:i,showAdd:b,setShowAdd:d,showEdit:v,setShowEdit:s,showAdjust:j,setShowAdjust:k,showTransfer:I,setShowTransfer:f,showImport:B,setShowImport:T,addItem:ae,updateItem:(r,o)=>{const x=a.map(c=>c.sku===r.sku&&(c.warehouse||"Main")===(r.warehouse||"Main")&&(c.bin||"A-01-01")===(r.bin||"A-01-01")&&(c.lot||"")===(r.lot||"")?{...c,...o,updatedAt:new Date().toISOString().slice(0,10)}:c);C(x)},setQty:(r,o,x,c,n,N,S)=>{const w=a.map(y=>{if(!(y.sku===r&&(y.warehouse||"Main")===(o||"Main")&&(y.bin||"A-01-01")===(x||"A-01-01")&&(y.lot||"")===(c||"")))return y;Number(y.stockQty||0);const M=Math.max(0,Number(n||0));return{...y,stockQty:M,status:M>0?"Active":"Inactive",updatedAt:new Date().toISOString().slice(0,10)}});C(w);const A=a.find(y=>y.sku===r&&(y.warehouse||"Main")===(o||"Main")&&(y.bin||"A-01-01")===(x||"A-01-01")&&(y.lot||"")===(c||"")),Q=A?Number(A.stockQty||0):0,F=Math.max(0,Number(n||0));D({type:"adjustment",sku:r,warehouse:o||"Main",bin:x||"A-01-01",lot:c||"",delta:F-Q,newQty:F,reason:N,ref:S}),k(null)},transferQty:(r,o,x,c,n)=>{if(!o||o<=0||x===c){f(null);return}const N=a.map(w=>w.sku===r&&(w.warehouse||"Main")===x?{...w,stockQty:Math.max(0,Number(w.stockQty||0)-Number(o||0)),updatedAt:new Date().toISOString().slice(0,10)}:w),S=N.findIndex(w=>w.sku===r&&(w.warehouse||"Main")===c);if(S>=0)N[S]={...N[S],stockQty:Number(N[S].stockQty||0)+Number(o||0),updatedAt:new Date().toISOString().slice(0,10)};else{const w=a.find(A=>A.sku===r);w&&N.push({...w,warehouse:c,stockQty:Number(o||0),bin:"A-01-01",updatedAt:new Date().toISOString().slice(0,10)})}C(N),D({type:"transfer",sku:r,qty:Number(o),from:x,to:c,ref:n}),f(null)},exportCsv:()=>{const r=["sku","name","stockQty","reserved","price","updatedAt","warehouse","bin","lot","expiry"],o=[r.join(","),...a.map(N=>r.map(S=>N[S]).join(","))].join(`
`),x=new Blob([o],{type:"text/csv"}),c=URL.createObjectURL(x),n=document.createElement("a");n.href=c,n.download="inventory.csv",n.click()},importCsv:r=>{if(!r)return;const o=new FileReader;o.onload=x=>{const n=x.target.result.split(`
`),N=n[0].split(",").map(Q=>Q.trim()),S=[];let w=E(a);for(let Q=1;Q<n.length;Q++){const F=n[Q].split(",");if(F.length!==N.length)continue;const y={};N.forEach((ce,ie)=>{y[ce]=F[ie].trim()});const M=String(y.sku||""),le=/^WH\/IV\/\d+$/.test(M)?M:`WH/IV/${w++}`;S.push({...y,sku:le,stockQty:Number(y.stockQty||0),price:Number(y.price||0),reserved:Number(y.reserved||0),incomingQty:0,outgoingQty:0,minStock:Number(y.minStock||0),reorderQty:Number(y.reorderQty||0),updatedAt:y.updatedAt||new Date().toISOString().slice(0,10),instock:1,photo:"/eit-icon.png"})}const A=[...S,...a];C(A),T(!1)},o.readAsText(r)},warehouses:se,role:V,setRole:U,refQuery:P,setRefQuery:J,categories:re,categoryFilter:H,setCategoryFilter:K,showReceive:G,setShowReceive:R,showDeliver:z,setShowDeliver:O,receiveQty:(r,o,x)=>{if(!o||o<=0){R(null);return}const c=a.map(n=>n.sku===r?{...n,stockQty:Number(n.stockQty||0)+Number(o||0),incomingQty:Math.max(0,Number(n.incomingQty||0)-Number(o||0)),updatedAt:new Date().toISOString().slice(0,10)}:n);C(c),D({type:"purchase_receipt",sku:r,qty:Number(o),ref:x}),R(null)},deliverQty:(r,o,x)=>{if(!o||o<=0){O(null);return}const c=a.map(n=>n.sku===r?{...n,stockQty:Math.max(0,Number(n.stockQty||0)-Number(o||0)),outgoingQty:Math.max(0,Number(n.outgoingQty||0)-Number(o||0)),updatedAt:new Date().toISOString().slice(0,10)}:n);C(c),D({type:"sales_delivery",sku:r,qty:Number(o),ref:x}),O(null)},items:a,showHistory:_,setShowHistory:X,view:Y,setView:Z,historyFilter:q,setHistoryFilter:ee}}function xe({inv:t}){const h=s=>`à¸¿ ${Number(s).toLocaleString("th-TH")}`,[g,u]=l.useState(null),[i,p]=l.useState(null),[a,m]=l.useState(""),b=s=>`${s.sku}-${s.warehouse||"Main"}-${s.bin||"A-01-01"}-${s.lot||""}`,d=(s,j)=>{s.key==="Enter"?(t.updateItem(j,{[i]:i==="price"?Number(a):a}),u(null),p(null)):s.key==="Escape"&&(u(null),p(null))},v=s=>{t.updateItem(s,{[i]:i==="price"?Number(a):a}),u(null),p(null)};return e.jsxs("div",{className:"",children:[t.pageItems.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-8 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"No items found"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Try adjusting your search or add a new item"}),e.jsx("button",{onClick:()=>t.setShowAdd(!0),className:"mt-4 btn-pill",children:"Add Item"})]}):e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow-sm border",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[#2D4485] bg-gray-50",children:[e.jsx("th",{className:"p-3 text-left",children:"Item Photo"}),e.jsx("th",{className:"p-3 text-left cursor-pointer",onClick:()=>t.toggleSort("sku"),children:"Product Number"}),e.jsx("th",{className:"p-3 text-left cursor-pointer",onClick:()=>t.toggleSort("name"),children:"Name"}),e.jsx("th",{className:"p-3 text-left cursor-pointer",onClick:()=>t.toggleSort("stockQty"),children:"Stock"}),e.jsx("th",{className:"p-3 text-left cursor-pointer",onClick:()=>t.toggleSort("price"),children:"Price"}),e.jsx("th",{className:"p-3 text-left cursor-pointer",onClick:()=>t.toggleSort("updatedAt"),children:"Last Updated"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:t.pageItems.map((s,j)=>{const k=b(s),I=f=>g===k&&i===f;return e.jsxs("tr",{className:"border-t odd:bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("td",{className:"p-3",children:I("photo")?e.jsx("input",{autoFocus:!0,className:"w-full rounded-md border border-gray-300 px-2 py-1",value:a,onChange:f=>m(f.target.value),onBlur:()=>v(s),onKeyDown:f=>d(f,s)}):e.jsx("img",{src:s.photo||"/eit-icon.png",alt:"",className:"w-10 h-10 rounded object-cover cursor-pointer hover:opacity-80",title:"Click to edit photo URL",onClick:()=>{u(k),p("photo"),m(s.photo||"")}})}),e.jsx("td",{className:"p-3 text-gray-900",children:s.sku}),e.jsx("td",{className:"p-3 text-gray-700",children:I("name")?e.jsx("input",{autoFocus:!0,className:"w-full rounded-md border border-gray-300 px-2 py-1",value:a,onChange:f=>m(f.target.value),onBlur:()=>v(s),onKeyDown:f=>d(f,s)}):e.jsx("span",{className:"cursor-pointer hover:text-[#2D4485] hover:underline",onClick:()=>{u(k),p("name"),m(s.name)},children:s.name})}),e.jsx("td",{className:"p-3",children:Number(s.stockQty).toLocaleString("en-US")}),e.jsx("td",{className:"p-3 text-[#2D4485] font-medium",children:I("price")?e.jsx("input",{autoFocus:!0,type:"number",className:"w-24 rounded-md border border-gray-300 px-2 py-1",value:a,onChange:f=>m(f.target.value),onBlur:()=>v(s),onKeyDown:f=>d(f,s)}):e.jsx("span",{className:"cursor-pointer hover:text-[#2D4485] hover:underline",onClick:()=>{u(k),p("price"),m(s.price)},children:h(s.price)})}),e.jsx("td",{className:"p-3",children:s.updatedAt}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{disabled:!(t.role==="Inventory Admin"||t.role==="Warehouse Staff"),onClick:()=>t.setShowAdjust({sku:s.sku,warehouse:s.warehouse||"Main",bin:s.bin||"A-01-01",lot:s.lot||"",current:Number(s.stockQty||0)}),className:"px-2 py-1 text-xs rounded-full border border-gray-300 bg-gray-100 text-gray-900 hover:bg-[#2D4485] hover:text-white disabled:opacity-50",children:"Update Stock"})})})]},j)})})]})}),t.showAdd&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowAdd(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-lg p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Add Inventory Item"}),e.jsx(W,{onCancel:()=>t.setShowAdd(!1),onSave:t.addItem})]})}),t.showEdit&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowEdit(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Edit Item"}),e.jsx(W,{initialData:t.showEdit,onCancel:()=>t.setShowEdit(null),onSave:s=>t.updateItem(t.showEdit,s)})]})}),t.showAdjust&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowAdjust(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Update Stock"}),e.jsx(ge,{sku:t.showAdjust.sku,current:t.showAdjust.current,onCancel:()=>t.setShowAdjust(null),onConfirm:(s,j)=>t.setQty(t.showAdjust.sku,t.showAdjust.warehouse,t.showAdjust.bin,t.showAdjust.lot,s,j,"")})]})}),t.showTransfer&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowTransfer(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Transfer Stock"}),e.jsx(pe,{sku:t.showTransfer.sku,from:t.showTransfer.from,warehouses:t.warehouses.filter(s=>s!=="All"),onCancel:()=>t.setShowTransfer(null),onConfirm:(s,j,k)=>t.transferQty(t.showTransfer.sku,s,t.showTransfer.from,j,k)})]})}),t.showReceive&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowReceive(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Receive Products"}),e.jsx(fe,{sku:t.showReceive.sku,onCancel:()=>t.setShowReceive(null),onConfirm:(s,j)=>t.receiveQty(t.showReceive.sku,s,j)})]})}),t.showDeliver&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowDeliver(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Deliver Products"}),e.jsx(Ne,{sku:t.showDeliver.sku,onCancel:()=>t.setShowDeliver(null),onConfirm:(s,j)=>t.deliverQty(t.showDeliver.sku,s,j)})]})}),t.showImport&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowImport(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Import CSV"}),e.jsx(ye,{onCancel:()=>t.setShowImport(!1),onFile:s=>t.importCsv(s)})]})})]})}function he({inv:t}){var h,g,u,i;return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Movement History"}),e.jsx(be,{sku:(h=t.historyFilter)==null?void 0:h.sku,warehouse:(g=t.historyFilter)==null?void 0:g.warehouse,bin:(u=t.historyFilter)==null?void 0:u.bin,lot:(i=t.historyFilter)==null?void 0:i.lot,onCancel:()=>t.setView("inventory")})]})})}function W({onCancel:t,onSave:h,initialData:g}){const u={sku:"WH/IV",name:"",photo:"",stockQty:0,reserved:0,price:0,warehouse:"Main",bin:"A-01-01",lot:"",expiry:"",incomingQty:0,outgoingQty:0,barcode:"",category:"Finished Goods",uom:"pcs",description:"",brand:"",model:"",status:"Active",minStock:0,reorderQty:0,valuationMethod:"FIFO",serials:"",manufactureDate:""},[i,p]=l.useState(g||u),a=!!i.name,m=(b,d)=>p(v=>({...v,[b]:d}));return e.jsxs("div",{className:"space-y-3",children:[g&&e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:i.sku})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Product name"}),e.jsx("input",{value:i.name,onChange:b=>m("name",b.target.value),required:!0,placeholder:"e.g. Laser Welding Machine",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Stock qty"}),e.jsx("input",{type:"number",min:0,value:i.stockQty,onChange:b=>m("stockQty",Math.max(0,Number(b.target.value))),placeholder:"e.g. 10",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",value:i.price,onChange:b=>m("price",Number(b.target.value)),placeholder:"e.g. 50000",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:t,className:"btn-pill",children:"Cancel"}),e.jsx("button",{disabled:!a,onClick:()=>h({...i,serials:[]}),className:"btn-pill disabled:opacity-50",children:"Save"})]})]})}function ge({sku:t,current:h=0,onCancel:g,onConfirm:u}){const[i,p]=l.useState(h),[a,m]=l.useState(""),b=Number.isFinite(i);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Current stock"}),e.jsx("input",{value:h,readOnly:!0,className:"w-full rounded-md border border-gray-300 px-3 py-2 bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"New stock"}),e.jsx("input",{type:"number",value:i,onChange:d=>p(Number(d.target.value)),className:"w-full rounded-md border border-gray-300 px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Note (optional)"}),e.jsx("input",{value:a,onChange:d=>m(d.target.value),placeholder:"Reason for change",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:g,className:"btn-pill",children:"Cancel"}),e.jsx("button",{disabled:!b,onClick:()=>u(Number(i),a||"Stock update"),className:"btn-pill disabled:opacity-50",children:"Confirm"})]})]})}function pe({sku:t,from:h,warehouses:g,onCancel:u,onConfirm:i}){const[p,a]=l.useState(0),[m,b]=l.useState(g.find(s=>s!==h)||"Secondary"),[d,v]=l.useState("");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:p,onChange:s=>a(Number(s.target.value)),placeholder:"Qty",className:"rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"rounded-md border border-gray-300 px-3 py-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"From"}),e.jsx("div",{className:"text-sm font-semibold",children:h})]}),e.jsx("select",{value:m,onChange:s=>b(s.target.value),className:"rounded-md border border-gray-300 px-3 py-2",children:g.map(s=>s!=="All"&&e.jsx("option",{children:s},s))})]}),e.jsx("input",{value:d,onChange:s=>v(s.target.value),placeholder:"Reference (e.g. Source Document)",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:u,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>i(p,m,d),className:"btn-pill",children:"Transfer"})]})]})}function ye({onCancel:t,onFile:h}){const[g,u]=l.useState(null);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",onChange:i=>{var p;return u(((p=i.target.files)==null?void 0:p[0])||null)},className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Headers: sku,name,stockQty,reserved,price,updatedAt,warehouse,bin,lot,expiry"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:t,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>h&&h(g),className:"btn-pill",children:"Import"})]})]})}function be({sku:t,warehouse:h,bin:g,lot:u,onCancel:i}){const[p,a]=l.useState([]);l.useEffect(()=>{try{const v=JSON.parse(localStorage.getItem("inventoryMovements")||"[]").filter(s=>t?(s.sku||"")===t:!0).filter(s=>h?(s.warehouse||"Main")===h:!0).filter(s=>g?(s.bin||"A-01-01")===g:!0).filter(s=>u?(s.lot||"")===u:!0).sort((s,j)=>String(j.ts).localeCompare(String(s.ts))).slice(0,50);a(v)}catch{a([])}},[t,h,g,u]);const m=d=>d.delta!=null?d.delta:d.qty!=null?d.qty:"",b=`${h||"Main"} / ${g||"A-01-01"}${u?" / "+u:""}`;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Location: ",b]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[#2D4485]",children:[e.jsx("th",{className:"p-2 text-left",children:"Date"}),e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Change"}),e.jsx("th",{className:"p-2 text-left",children:"New Qty"}),e.jsx("th",{className:"p-2 text-left",children:"Reason"}),e.jsx("th",{className:"p-2 text-left",children:"Ref"}),e.jsx("th",{className:"p-2 text-left",children:"User"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-600",colSpan:7,children:"No movements found"})}):p.map((d,v)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:String(d.ts).slice(0,19).replace("T"," ")}),e.jsx("td",{className:"p-2",children:d.type}),e.jsx("td",{className:"p-2",children:m(d)}),e.jsx("td",{className:"p-2",children:d.newQty!=null?d.newQty:""}),e.jsx("td",{className:"p-2",children:d.reason||""}),e.jsx("td",{className:"p-2",children:d.ref||d.from||d.to||""}),e.jsx("td",{className:"p-2",children:d.user||""})]},v))})]})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:i,className:"btn-pill",children:"Close"})})]})}function fe({sku:t,onCancel:h,onConfirm:g}){const[u,i]=l.useState(0),[p,a]=l.useState("");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsx("input",{type:"number",value:u,onChange:m=>i(Number(m.target.value)),placeholder:"Qty received",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{value:p,onChange:m=>a(m.target.value),placeholder:"PO/GRN Reference",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:h,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>g(u,p),className:"btn-pill",children:"Receive"})]})]})}function Ne({sku:t,onCancel:h,onConfirm:g}){const[u,i]=l.useState(0),[p,a]=l.useState("");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Reference: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsx("input",{type:"number",min:0,value:u,onChange:m=>i(Math.max(0,Number(m.target.value))),placeholder:"Qty delivered",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{value:p,onChange:m=>a(m.target.value),placeholder:"SO/DO Reference",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:h,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>g(u,p),className:"btn-pill",children:"Deliver"})]})]})}function je(){const t=me();return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(ue,{}),e.jsx("section",{className:"w-full py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Inventory Control Tower"}),e.jsx("button",{className:"inline-flex items-center justify-center min-w-[150px] btn-pill",title:"Add Item",onClick:()=>t.setShowAdd(!0),children:"Add Item"}),e.jsx("button",{onClick:()=>t.setShowImport(!0),className:"btn-pill",children:"Import"}),e.jsx("button",{onClick:t.exportCsv,className:"btn-pill",children:"Export"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{value:t.query,onChange:h=>t.setQuery(h.target.value),className:"w-64 rounded-md border border-gray-300 px-3 py-2",placeholder:"Search by name or product number"}),e.jsx("button",{onClick:()=>{t.setHistoryFilter(null),t.setView(t.view==="history"?"inventory":"history")},className:"btn-pill",children:t.view==="history"?"Inventory":"History"})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:t.view==="history"?e.jsx(he,{inv:t}):e.jsx(xe,{inv:t})})]})})]})}de.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(je,{})}));
